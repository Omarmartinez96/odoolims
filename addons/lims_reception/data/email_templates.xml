<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>
    <record id="email_template_comprobante" model="mail.template">
      <field name="name">Comprobante de Cadena de Custodia</field>
      <field name="model_id" model="ir.model" search="[('model','=','lims.custody_chain')]"/>
      <field name="email_from">${(user.email or '')|safe}</field>
      
      <!-- ðŸ”§ EMAIL_TO SIMPLIFICADO -->
      <field name="email_to">
% set emails = []
% if object.cliente_id and object.cliente_id.email:
  % do emails.append(object.cliente_id.email)
% endif
% for contact in object.contact_ids:
  % if contact.email:
    % do emails.append(contact.email)
  % endif
% endfor
${','.join(emails)}
      </field>

      <field name="subject">Comprobante de Cadena de Custodia</field>
      <field name="body_html"><![CDATA[
        <p>Estimado/a Cliente,</p>
        <p>Adjunto el comprobante correspondiente a la siguiente Cadena de Custodia:</p>
        <p><strong>CÃ³digo:</strong> {object.custody_chain_code}</p>
        <p>Gracias por su confianza.</p>
        <br/>
        <p>Atentamente,<br/>El equipo de {user.company_id.name}</p>
      ]]></field>
    </record>
  </data>
</odoo>