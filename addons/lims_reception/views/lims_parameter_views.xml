<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- ========== PLANTILLAS (par√°metros con is_template=True) ========== -->
        
        <!-- Vista Lista de Plantillas -->
        <record id="view_parameter_template_list" model="ir.ui.view">
            <field name="name">lims.sample.parameter.template.list</field>
            <field name="model">lims.sample.parameter</field>
            <field name="arch" type="xml">
                <list string="Plantillas de Par√°metros" create="true" edit="false">
                    <field name="name"/>
                    <field name="category"/>
                    <field name="method"/>
                    <field name="unit"/>
                    <field name="microorganism"/>
                    <field name="times_used"/>
                    <field name="active"/>
                </list>
            </field>
        </record>

        <!-- Vista Formulario de Plantillas -->
        <record id="view_parameter_template_form" model="ir.ui.view">
            <field name="name">lims.sample.parameter.template.form</field>
            <field name="model">lims.sample.parameter</field>
            <field name="arch" type="xml">
                <form string="Plantilla de Par√°metro">
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Ej: Coliformes totales" required="1"/>
                            </h1>
                        </div>

                        <!-- Campo oculto para marcar como plantilla -->
                        <field name="is_template" invisible="1"/>
                        <field name="sample_id" invisible="1"/>

                        <!-- Informaci√≥n b√°sica -->
                        <group>
                            <group string="üìã Informaci√≥n General">
                                <field name="category"/>
                                <field name="microorganism" placeholder="Ej: Coliformes totales, E. coli"/>
                                <field name="active"/>
                                <field name="times_used" readonly="1"/>
                            </group>
                            <group string="üî¨ M√©todo y Unidades">
                                <field name="method" placeholder="Ej: NOM-113, ASTM D1293"/>
                                <field name="unit" placeholder="Ej: UFC/g, mg/L, ¬µg/g"/>
                                <field name="method_reference" placeholder="Referencia completa"/>
                            </group>
                        </group>

                        <!-- Descripci√≥n -->
                        <group string="üìù Descripci√≥n">
                            <field name="description" 
                                  placeholder="Descripci√≥n detallada del procedimiento..."/>
                        </group>

                        <!-- Notebook para campos adicionales -->
                        <notebook>
                            <page string="üß™ Condiciones de An√°lisis">
                                <group>
                                    <group>
                                        <field name="incubation_temperature"/>
                                        <field name="incubation_time"/>
                                    </group>
                                    <group>
                                        <field name="ph_conditions"/>
                                        <field name="detection_limit"/>
                                        <field name="quantification_limit"/>
                                    </group>
                                </group>
                                
                                <group>
                                    <field name="sample_preparation"/>
                                    <field name="preservation_conditions"/>
                                </group>
                            </page>

                            <page string="üß™ Medios por Proceso" invisible="category != 'microbiological'">
                                <div class="alert alert-info" style="margin-bottom: 15px;">
                                    <strong>‚ÑπÔ∏è Configuraci√≥n de Medios por Proceso:</strong> 
                                    Define qu√© medios se utilizar√°n en cada etapa del an√°lisis microbiol√≥gico.
                                </div>
                                
                                <field name="media_by_process_ids" nolabel="1">
                                    <list string="Medios por Proceso" editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="process_type"/>
                                        <field name="culture_media_name" placeholder="Nombre del medio"/>
                                        <field name="media_usage"/>
                                        <field name="notes" placeholder="Instrucciones espec√≠ficas..."/>
                                    </list>
                                </field>
                            </page>
                        </notebook>

                    </sheet>
                </form>
            </field>
        </record>

        <!-- Acci√≥n para Plantillas -->
        <record id="action_parameter_templates" model="ir.actions.act_window">
            <field name="name">Plantillas de Par√°metros</field>
            <field name="res_model">lims.sample.parameter</field>
            <field name="domain">[('is_template', '=', True)]</field>
            <field name="context">{'default_is_template': True}</field>
            <field name="view_mode">list,form</field>
            <field name="view_id" ref="view_parameter_template_list"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crear la primera plantilla de par√°metro
                </p>
                <p>
                    Defina los par√°metros que se analizan frecuentemente
                </p>
            </field>
        </record>

        <!-- ========== PAR√ÅMETROS DE MUESTRA ========== -->
        
        <!-- Vista Lista de Par√°metros de Muestra -->
        <record id="view_lims_sample_parameter_list" model="ir.ui.view">
            <field name="name">lims.sample.parameter.list</field>
            <field name="model">lims.sample.parameter</field>
            <field name="arch" type="xml">
                <list string="Par√°metros de An√°lisis">
                    <field name="name"/>
                    <field name="category"/>
                    <field name="method"/>
                    <field name="unit"/>
                    <field name="microorganism"/>
                </list>
            </field>
        </record>

        <!-- Vista Formulario de Par√°metros de Muestra -->
        <record id="view_lims_sample_parameter_form" model="ir.ui.view">
            <field name="name">lims.sample.parameter.form</field>
            <field name="model">lims.sample.parameter</field>
            <field name="arch" type="xml">
                <form string="Par√°metro de An√°lisis">
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="Nombre del par√°metro" required="1"/>
                            </h1>
                        </div>

                        <!-- Informaci√≥n b√°sica -->
                        <group>
                            <group string="üìã Informaci√≥n General">
                                <field name="category"/>
                                <field name="microorganism"/>
                            </group>
                            <group string="üî¨ M√©todo y Unidades">
                                <field name="method"/>
                                <field name="unit"/>
                            </group>
                        </group>

                        <!-- Acreditaciones -->
                        <group string="üèÜ Acreditaciones y Autorizaciones">
                            <group>
                                <field name="accreditation_iso"/>
                                <field name="authorized_cofepris"/>
                                <field name="accredited_ema"/>
                                <field name="other_accreditation"/>
                                <field name="other_accreditation_detail" invisible="other_accreditation == False"/>
                            </group>
                            <group>
                                <field name="analysis_internal"/>
                                <field name="analysis_external"/>
                                <field name="external_lab_name" invisible="analysis_external == False"/>
                            </group>
                        </group>

                        <!-- Tipos de muestra -->
                        <group string="üß™ Tipos de Muestra Aplicables">
                            <field name="applicable_sample_types" widget="many2many_tags" nolabel="1"/>
                        </group>

                        <!-- Descripci√≥n -->
                        <group string="üìù Descripci√≥n">
                            <field name="description" nolabel="1"/>
                        </group>

                        <!-- Condiciones de an√°lisis -->
                        <notebook>
                            <page string="üß™ Condiciones">
                                <group>
                                    <group>
                                        <field name="incubation_temperature"/>
                                        <field name="incubation_time"/>
                                    </group>
                                    <group>
                                        <field name="ph_conditions"/>
                                        <field name="method_reference"/>
                                        <field name="detection_limit"/>
                                        <field name="quantification_limit"/>
                                    </group>
                                </group>
                                
                                <group>
                                    <field name="sample_preparation"/>
                                    <field name="preservation_conditions"/>
                                </group>
                            </page>

                            <page string="üß™ Medios por Proceso" invisible="category != 'microbiological'">
                                <div class="alert alert-info" style="margin-bottom: 15px;">
                                    <strong>‚ÑπÔ∏è Configuraci√≥n Avanzada:</strong> 
                                    Define medios espec√≠ficos para cada etapa del an√°lisis. Esto se copiar√° autom√°ticamente al crear an√°lisis.
                                </div>
                                
                                <field name="media_by_process_ids" nolabel="1">
                                    <list string="Medios por Proceso" editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="process_type"/>
                                        <field name="culture_media_name" placeholder="Nombre del medio"/>
                                        <field name="media_usage"/>
                                        <field name="notes" placeholder="Ej: Incubar 35¬∞C por 24h, usar 1mL de muestra..."/>
                                    </list>
                                </field>
                            </page>

                            <page string="üéØ Controles de Calidad Espec√≠ficos">
                                <field name="quality_control_ids">
                                    <list editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="control_type_id" options="{'no_create': True}"/>
                                        <field name="expected_result"/>
                                        <field name="notes"/>
                                    </list>
                                </field>
                            </page>   

                            <page string="üìù Observaciones">
                                <group>
                                    <field name="analyst_notes"/>
                                    <field name="observations"/>
                                </group>
                            </page>
                        </notebook>

                        <!-- Bot√≥n para crear plantilla -->
                        <div class="oe_chatter">
                            <button name="action_save_as_template" 
                                    type="object" 
                                    string="üíæ Guardar como Plantilla"
                                    class="btn-secondary"
                                    invisible="is_template == True"/>
                        </div>

                    </sheet>
                </form>
            </field>
        </record>

    </data>
</odoo>