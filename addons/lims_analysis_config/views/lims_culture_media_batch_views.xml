<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- ========== VISTAS PROFESIONALES PARA LOTES ========== -->
        
        <!-- Vista Lista Mejorada -->
        <record id="view_culture_media_batch_list" model="ir.ui.view">
            <field name="name">lims.culture.media.batch.list</field>
            <field name="model">lims.culture.media.batch</field>
            <field name="arch" type="xml">
                <list string="Lotes de Medios Preparados" 
                    default_order="preparation_date desc, batch_code desc"
                    decoration-warning="expiry_date and expiry_date &lt; context_today()">
                    <field name="batch_code" string="Código de Lote"/>
                    <field name="culture_media_id" string="Medio de Cultivo"/>
                    <field name="preparation_date" string="Fecha Preparación"/>
                    <field name="volume_prepared" string="Volumen (mL)"/>
                    <field name="analyst_id" string="Preparado por"/>
                    <field name="expiry_date" string="Vencimiento"/>
                </list>
            </field>
        </record>

        <!-- Vista Formulario Mejorada -->
        <record id="view_culture_media_batch_form" model="ir.ui.view">
            <field name="name">lims.culture.media.batch.form</field>
            <field name="model">lims.culture.media.batch</field>
            <field name="arch" type="xml">
                <form string="Lote de Medio Preparado">
                    <sheet>
                        
                        <!-- Título con código automático -->
                        <div class="oe_title">
                            <h1>
                                <field name="batch_code" readonly="1" placeholder="Se genera automáticamente"/>
                            </h1>
                            <h2>
                                <field name="culture_media_id" placeholder="Seleccionar medio de cultivo" required="1"/>
                            </h2>
                        </div>

                        <!-- Información Principal -->
                        <group>
                            <group string="Información de Preparación">
                                <field name="preparation_date" required="1"/>
                                
                                <field name="analyst_id" readonly="1" invisible="not analyst_id"/>
                                
                                <button name="action_assign_analyst"
                                        type="object"
                                        string="Seleccionar responsable"
                                        class="btn-primary"
                                        invisible="analyst_id"
                                        help="Seleccionar analista responsable con verificación PIN"/>
                                
                                <button name="action_change_analyst"
                                        type="object"
                                        string="Cambiar responsable"
                                        class="btn-secondary"
                                        invisible="not analyst_id"
                                        help="Cambiar el analista responsable"/>
                                
                                <field name="media_type" invisible="1"/>
                            </group>
                        </group>

                        <!-- Ejemplo Visual del Código -->
                        <group string="💡 Información del Código Generado">
                            <div style="padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <p style="margin: 0; font-weight: bold;">Formato del código:</p>
                                <p style="margin: 5px 0 0 0; font-family: monospace; color: #2e7d32;">
                                    [Prefijo]-[DDMMAA]-[Consecutivo]
                                </p>
                                <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">
                                    Ejemplo: TSA-270825-1, TSA-270825-2, MAC-270825-1
                                </p>
                            </div>
                        </group>

                        <!-- Notas de Preparación -->
                        <group string="📝 Notas de Preparación">
                            <field name="preparation_notes" 
                                   nolabel="1" 
                                   placeholder="Observaciones durante la preparación: condiciones especiales, modificaciones, etc..."
                                   rows="3"/>
                        </group>

                    </sheet>
                </form>
            </field>
        </record>

        <!-- ========== ACCIÓN MEJORADA ========== -->
        
        <!-- Acción para lotes de medios -->
        <record id="action_culture_media_batches" model="ir.actions.act_window">
            <field name="name">🧪 Medios Preparados</field>
            <field name="res_model">lims.culture.media.batch</field>
            <field name="view_mode">list,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'list', 'view_id': ref('view_culture_media_batch_list')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('view_culture_media_batch_form')})]"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    🧪 Registrar el primer lote preparado
                </p>
                <p>
                    Registre lotes de medios preparados con códigos automáticos y control de calidad integrado.
                </p>
            </field>
        </record>

        <!-- ========== MENÚ RAÍZ ========== -->
        <menuitem id="menu_lims_analysis_config_root" 
                name="Configuración de Variables" 
                sequence="5"/>

        <!-- ========== MENÚS PADRE ========== -->
        <menuitem id="menu_medios_reactivos" 
                name="Medios y Reactivos" 
                parent="menu_lims_analysis_config_root" 
                sequence="10"/>

        <menuitem id="menu_culture_media_with_qc" 
                name="Medios de Cultivo" 
                parent="menu_medios_reactivos" 
                action="action_lims_culture_media"
                sequence="10"/>
       

        <menuitem id="menu_plantillas" 
                name="Plantillas" 
                parent="menu_lims_analysis_config_root" 
                sequence="20"/>

        <menuitem id="menu_variables_controles" 
                name="Variables y Controles" 
                parent="menu_lims_analysis_config_root" 
                sequence="30"/>

        <menuitem id="menu_activos_equipos" 
                name="Activos y Equipos" 
                parent="menu_lims_analysis_config_root" 
                sequence="40"/>

        <!-- ========== MEDIOS Y REACTIVOS ========== -->

        <menuitem id="menu_culture_media_batches" 
                name="Medios Preparados" 
                parent="menu_medios_reactivos" 
                action="action_culture_media_batches" 
                sequence="20"/>

        <!-- ========== PLANTILLAS ========== -->
        <menuitem id="menu_parameter_templates" 
                name="Plantillas de Parámetros" 
                parent="menu_plantillas" 
                action="lims_reception.action_parameter_templates" 
                sequence="10"/>

        <menuitem id="menu_sample_templates" 
                name="Plantillas de Muestras"
                parent="menu_plantillas"
                action="lims_reception.action_lims_sample_templates" 
                sequence="20"/>

        <!-- ========== VARIABLES Y CONTROLES ========== -->
        <menuitem id="menu_lims_sample_types" 
                name="Tipos de Muestra" 
                parent="menu_variables_controles" 
                action="lims_reception.action_lims_sample_types" 
                sequence="10"/>

        <menuitem id="menu_lims_container_types" 
                name="Tipos de Recipiente" 
                parent="menu_variables_controles" 
                action="lims_reception.action_lims_container_types" 
                sequence="20"/>

        <menuitem id="menu_quality_control_types" 
                name="Tipos de Control de Calidad" 
                parent="menu_variables_controles" 
                action="lims_reception.action_quality_control_types" 
                sequence="30"/>

        <!-- ========== ACTIVOS Y EQUIPOS ========== -->
        <menuitem id="menu_lims_lab_equipment" 
                name="Equipos de Laboratorio" 
                parent="menu_activos_equipos" 
                action="action_lims_lab_equipment" 
                sequence="10"/>

    </data>
</odoo>