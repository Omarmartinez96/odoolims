<odoo>
  <template id="report_saleorder_custom">
    <t t-call="lims_sale_extension.external_layout_inherit_lims">
      <!-- Definir company en el contexto para evitar KeyError -->
      <t t-set="company" t-value="docs and docs[0].company_id"/>
      <t t-foreach="docs" t-as="doc"="docs" t-as="doc">
        <main class="o_report_layout" style="margin-top:0 !important;">
          <div class="page">

            <!-- Encabezado interno de cotización -->
            <div class="row" style="margin-bottom:5px;">
              <div class="col-12 text-center">
                <h4 style="color:#006699; font-size:16px; margin:0;">COTIZACIÓN DE SERVICIOS</h4>
                <p style="font-size:11px; margin-top:4px;"><strong>Referencia:</strong> <t t-esc="doc.name"/></p>
              </div>
            </div>

            <!-- Datos del cliente -->
            <div class="row mb-2" style="font-size:10px;">
              <div class="col-6">
                <strong>Cliente:</strong> <t t-esc="doc.partner_id.name"/><br/>
                <t t-esc="doc.partner_id.contact_address"/><br/>
                <strong>RFC:</strong> <t t-esc="doc.partner_id.vat"/>
              </div>
              <div class="col-6 text-end">
                <strong>Fecha:</strong> <t t-esc="doc.date_order.strftime('%d/%m/%Y')"/><br/>
                <strong>Pago:</strong> <t t-esc="doc.payment_term_id.name"/>
              </div>
            </div>

            <!-- Tabla de productos -->
            <table class="table table-sm mt-2" style="width:100%; font-size:11px;">
              <thead>
                <tr style="background-color:#f0f0f0;">
                  <th style="width:50%;">Producto</th>
                  <th class="text-center">Cantidad</th>
                  <th class="text-end">Precio unitario</th>
                  <th class="text-end">Subtotal</th>
                </tr>
              </thead>
              <tbody>
                <t t-foreach="doc.order_line" t-as="line">
                  <tr>
                    <td>
                      <div><strong><t t-esc="line.product_id.display_name"/></strong></div>
                      <div style="white-space:pre-wrap; font-size:10px;"><t t-esc="line.name[len(line.product_id.display_name):].strip()"/></div>
                    </td>
                    <td class="text-center"><t t-esc="line.product_uom_qty"/></td>
                    <td class="text-end"><t t-esc="line.price_unit"/></td>
                    <td class="text-end"><t t-esc="line.price_subtotal"/></td>
                  </tr>
                </t>
              </tbody>
            </table>

            <!-- Resumen de totales -->
            <div class="row mt-3">
              <div class="col-6"/>
              <div class="col-6 text-end" style="font-size:10px;">
                <p><strong>Subtotal:</strong> <t t-esc="doc.amount_untaxed"/></p>
                <p><strong>Impuestos:</strong> <t t-esc="doc.amount_tax"/></p>
                <p><strong>Total:</strong> <t t-esc="doc.amount_total"/></p>
              </div>
            </div>

            <!-- Condiciones y políticas -->
            <div class="row mt-4">
              <div class="col-12">
                <h5 style="margin-bottom:6px;">Condiciones y Políticas</h5>
                <ul style="font-size:10px; line-height:1.5;">
                  <li><strong>Pago:</strong> 50% al ordenar, 50% antes de entrega.</li>
                  <li><strong>Cancelación:</strong> No reembolsable una vez iniciado el análisis.</li>
                  <li><strong>Revisión:</strong> Aprobado por el área técnica.</li>
                  <li><strong>Nota:</strong> No es un informe de resultados.</li>
                </ul>
              </div>
            </div>

          </div>
        </main>
      </t>
    </t>
  </template>
</odoo>