<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE PRELIMINAR -->
    <!-- Ejemplo: <template id="report_analysis_preliminary_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE FINAL -->
    <!-- Ejemplo: <template id="report_analysis_final_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE PARA FIRMA MANUAL -->
    <!-- Ejemplo: <template id="report_analysis_signing_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE BIOBURDEN -->
    <!-- Ejemplo: <template id="report_bioburden_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE PARTÍCULAS VIABLES -->
    <!-- Ejemplo: <template id="report_viable_particles_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE ENDOTOXINAS -->
    <!-- Ejemplo: <template id="report_endotoxin_template"> -->
    <!-- ========================================================= -->

    <!-- ========== TEMPLATE GENERAL ILAC (CON DATOS DINÁMICOS CORRECTOS) ========== -->
    <template id="report_general_ilac_template">
        <t t-call="web.html_container">
            <meta charset="UTF-8"/>
            <t t-call-assets="web.report_assets_common" t-js="false"/>
            <t t-set="company" t-value="env.company"/>
            
            <!-- ✅ VARIABLES MOVIDAS FUERA DEL LOOP -->
            <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
            <t t-set="language" t-value="report_config.get('language', 'es')"/>
            <t t-set="status" t-value="report_config.get('status', 'final')"/>

            <!-- HEADER GLOBAL (FUERA DEL LOOP) -->
            <div class="header">
                <table style="height: 100px; border: none !important; border-collapse: collapse !important; width: 100%;">
                    <tr style="height: 80px; border: none !important;">
                        <!-- LOGO IZQUIERDA -->
                        <td style="width: 20%; text-align: left; vertical-align: middle; border: none !important; padding: 10px 8px;">
                            <img t-if="company.logo"
                                t-att-src="image_data_uri(company.logo)"
                                style="max-height: 108px; width: auto;"/>
                        </td>
                        
                        <!-- INFORMACIÓN DEL LABORATORIO CENTRO -->
                        <td style="width: 60%; text-align: center; vertical-align: middle; border: none !important; padding: 10px 5px;">
                            <div style="text-align: center; font-family: Arial, sans-serif;">
                                <!-- Nombre del laboratorio - SIEMPRE EN ESPAÑOL -->
                                <div style="font-size: 18px; font-weight: bold; color: #000; margin-bottom: 2px;">
                                    Laboratorio de Microbiología
                                </div>
                                
                                <!-- Nombre PROTEUS - SIEMPRE IGUAL -->
                                <div style="font-size: 18px; font-weight: bold; color: #000; margin-bottom: 8px;">
                                    PROTEUS
                                </div>
                                
                                <!-- ✅ TIPO DE REPORTE - SIN DEBUG -->
                                <div style="font-size: 14px; font-weight: bold; color: #000; position: absolute; left: 50%; transform: translateX(-50%); width: 100vw; margin-left: -50vw;">
                                    <t t-if="language == 'es'">INFORME DE ENSAYO</t>
                                    <t t-else="">TEST REPORT</t>
                                </div>
                            </div>
                        </td>
                        
                        <!-- LOGOS PLACEHOLDER DERECHA -->
                        <td style="width: 22%; vertical-align: middle; border: none !important; padding: 8px 8px;">
                            <div style="padding: 6px; min-height: 35px; display: flex; align-items: center; justify-content: center; font-size: 8px; width: 100%; box-sizing: border-box;">
                                <img src="/lims_analysis_v2/static/src/img/ilac_logos.png" 
                                    style="max-height: 108px; width: auto;" 
                                    alt="ILAC Logos"/>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- FOOTER GLOBAL (FUERA DEL LOOP) -->
            <div class="footer">
                <table style="width: 100%; font-size: 9px; margin: 0; padding: 0 0 15px 0; border-top: 1px solid #000; font-family: Arial, sans-serif;">
                    <tr>
                        <td style="width: 33%; text-align: left; padding: 3px;">
                            Teléfono: (664) 973-8185
                        </td>
                        <td style="width: 33%; text-align: center; padding: 3px;">
                            FOR-022 Rev. 03 / PROC-006
                        </td>
                        <td style="width: 33%; text-align: right; padding: 3px;">
                            contacto@proteuslaboratorio.com
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            Av. Defensores de Baja California 2163 Plaza Marina Local 5-A, Empleado Postal, Tijuana B.C.
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            Documento controlado, prohibida su reproducción parcial o total sin autorización.
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            Página <span class="page"/> de <span class="topage"/>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- CONTENIDO POR ANÁLISIS -->
            <t t-foreach="docs" t-as="analysis">

                <!-- CONTENIDO PRINCIPAL -->
                <div t-att-style="'page-break-inside: avoid; min-height: 90vh; font-family: Arial, sans-serif; font-size: 12px; line-height: 1.3;' + (' page-break-before: always;' if analysis_index > 0 else '')">
                    <div style="width: 100%; margin: 0; padding: 0;">

                        <!-- Badge preliminar si aplica -->
                        <t t-if="status == 'preliminary'">
                            <div style="text-align: center; margin: 15px 0;">
                                <span style="background-color: #ffc107; color: #212529; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">
                                    PRELIMINAR
                                </span>
                            </div>
                        </t>

                        <!-- INFORMACIÓN SUPERIOR -->
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 15px 0 1px 0;">
                            <tr>
                                <td style="width: 25%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Identificación de la muestra:</t>
                                    <t t-else="">Sample identification:</t>
                                </td>
                                <td style="width: 45%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;"><span t-esc="analysis.sample_identifier or 'Sin identificación'"/></td>
                                <td style="width: 20%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Fecha de emisión:</t>
                                    <t t-else="">Issue date:</t>
                                </td>
                                <td style="width: 10%; padding: 1px 15px 1px 15px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-set="today" t-value="datetime.datetime.now()"/>
                                    <span t-esc="today.strftime('%d/%b/%Y')"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Descripción de la muestra:</t>
                                    <t t-else="">Sample description:</t>
                                </td>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id">
                                        <span t-esc="analysis.sample_reception_id.sample_id.sample_description or 'Sin descripción'"/>
                                    </t>
                                    <t t-else="">Sin descripción</t>
                                </td>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Cadena de custodia:</t>
                                    <t t-else="">Chain of custody:</t>
                                </td>
                                <td style="width: 10%; padding: 1px 15px 1px 15px; vertical-align: middle; line-height: 1.2; text-align: left;"><span t-esc="analysis.custody_chain_code or 'Sin código'"/></td>
                            </tr>
                        </table>

                        <!-- DATOS DEL CLIENTE -->
                        <div style="background-color: rgb(218,227,243); font-weight: bold; padding: 6px; text-align: center; font-size: 12px; margin: 10px 0 5px 0; page-break-inside: avoid;">
                            <t t-if="language == 'es'">DATOS DEL CLIENTE</t>
                            <t t-else="">CUSTOMER DATA</t>
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 1px 0;">
                            <tr>
                                <td style="width: 22%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Nombre o Razón social:</t>
                                    <t t-else="">Name or Company name:</t>
                                </td>
                                <td style="width: 78%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.name"/>
                                    </t>
                                    <t t-else="">Sin cliente especificado</t>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Dirección fiscal:</t>
                                    <t t-else="">Fiscal address:</t>
                                </td>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.street or ''"/>
                                        <t t-if="analysis.customer_id.street2">, <span t-esc="analysis.customer_id.street2"/></t>
                                        <t t-if="analysis.customer_id.city">, <span t-esc="analysis.customer_id.city"/></t>
                                        <t t-if="analysis.customer_id.zip"> C.P. <span t-esc="analysis.customer_id.zip"/></t>
                                    </t>
                                    <t t-else="">Sin dirección</t>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Código de cliente:</t>
                                    <t t-else="">Customer code:</t>
                                </td>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-if="analysis.customer_id and analysis.customer_id.client_code">
                                        <span t-esc="analysis.customer_id.client_code"/>
                                    </t>
                                    <t t-else="">N/A</t>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                    <t t-if="language == 'es'">Contacto:</t>
                                    <t t-else="">Contact:</t>
                                </td>
                                <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                    <t t-if="analysis.custody_chain_id and analysis.custody_chain_id.contact_ids">
                                        <span t-esc="', '.join([c.name for c in analysis.custody_chain_id.contact_ids])"/>
                                    </t>
                                    <t t-else="">N/A</t>
                                </td>
                            </tr>
                        </table>

                        <!-- INFORMACIÓN DE MUESTREO Y RECEPCIÓN -->
                        <table style="width: 100%; border-collapse: collapse; margin: 8px 0; page-break-inside: avoid;">
                            <tr>
                                <td style="width: 50%; vertical-align: middle; padding: 0 8px;">
                                    <div style="background-color: rgb(218,227,243); font-weight: bold; padding: 6px; text-align: center; font-size: 12px; margin: 10px 0 5px 0; page-break-inside: avoid;">
                                        <t t-if="language == 'es'">INFORMACIÓN DE MUESTREO</t>
                                        <t t-else="">SAMPLING INFORMATION</t>
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 1px 0;">
                                        <tr>
                                            <td style="width: 45%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">
                                                <t t-if="language == 'es'">Fecha y hora de muestreo:</t>
                                                <t t-else="">Sampling date and time:</t>
                                            </td>
                                            <td style="width: 55%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sampling_date">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sampling_date.strftime('%d/%b/%Y')"/>
                                                    <t t-if="analysis.sample_reception_id.sample_id.sampling_time">
                                                        <br/><span t-esc="analysis.sample_reception_id.sample_id.sampling_time"/>
                                                    </t>
                                                </t>
                                                <t t-else="">-</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Tipo de muestra:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sample_type_id">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sample_type_id.name"/>
                                                </t>
                                                <t t-else="">No especificado</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Sitio de muestreo:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">Empresa</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Muestreador:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sampling_technician">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sampling_technician"/>
                                                </t>
                                                <t t-else="">Cliente</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Método/plan de muestreo (si aplica):</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">N/A</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Observaciones:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sampling_observations and analysis.sample_reception_id.sample_id.sampling_observations != 'N/A'">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sampling_observations"/>
                                                </t>
                                                <t t-else="">Muestra proporcionada por el cliente</t>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                                
                                <td style="width: 50%; vertical-align: middle; padding: 0 8px;">
                                    <div style="background-color: rgb(218,227,243); font-weight: bold; padding: 6px; text-align: center; font-size: 12px; margin: 10px 0 5px 0; page-break-inside: avoid;">
                                        <t t-if="language == 'es'">INFORMACIÓN DE RECEPCIÓN</t>
                                        <t t-else="">RECEPTION INFORMATION</t>
                                    </div>
                                    <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 1px 0;">
                                        <tr>
                                            <td style="width: 45%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Fecha y hora de recepción:</td>
                                            <td style="width: 55%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.reception_date">
                                                    <span t-esc="analysis.sample_reception_id.reception_date.strftime('%d/%b/%Y')"/>
                                                    <t t-if="analysis.sample_reception_id.reception_time">
                                                        <br/><span t-esc="analysis.sample_reception_id.reception_time"/>
                                                    </t>
                                                </t>
                                                <t t-else="">-</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Clave de la muestra:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;"><span t-esc="analysis.sample_code or 'Sin código'"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Cantidad de muestra:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sample_quantity">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sample_quantity"/>
                                                </t>
                                                <t t-else="">No especificada</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Temperatura de recepción:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">-</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Recipiente de la muestra:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.container_type_id">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.container_type_id.name"/>
                                                </t>
                                                <t t-else="">No especificado</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Recibió:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.analyst_id">
                                                    <span t-esc="analysis.sample_reception_id.analyst_id.full_name or analysis.sample_reception_id.analyst_id.initials"/>
                                                </t>
                                                <t t-else="">No especificado</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Observaciones:</td>
                                            <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.reception_notes">
                                                    <span t-esc="analysis.sample_reception_id.reception_notes"/>
                                                </t>
                                                <t t-else="">Sin observaciones</t>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- DATOS DEL ANÁLISIS -->
                        <div style="background-color: rgb(218,227,243); font-weight: bold; padding: 6px; text-align: center; font-size: 12px; margin: 10px 0 5px 0; page-break-inside: avoid;">DATOS DEL ANÁLISIS</div>
                        
                        <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 8px auto; page-break-inside: auto; border: none;">
                            <thead>
                                <tr style="page-break-inside: avoid;">
                                    <th style="width: 14%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Parámetro</th>
                                    <th style="width: 18%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Método</th>
                                    <th style="width: 3%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">C</th>
                                    <th style="width: 3%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">T</th>
                                    <th style="width: 4%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">LAB</th>
                                    <th style="width: 12%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Resultado</th>
                                    <th style="width: 10%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Unidades</th>
                                    <th style="width: 12%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Referencia</th>
                                    <th style="width: 10%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">Fecha de análisis</th>
                                    <th style="width: 4%; border: none; padding: 5px 3px; vertical-align: middle; text-align: center; background-color: rgb(218,227,243); font-weight: bold; font-size: 10px;">AN</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="analysis_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                                <t t-foreach="analysis_params" t-as="parameter">
                                    <tr style="page-break-inside: avoid;">
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;"><span t-esc="parameter.microorganism or parameter.name or 'Sin nombre'"/></td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;"><span t-esc="parameter.method or 'No especificado'"/></td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">C</td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">T</td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">LAB</td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;"><span t-esc="parameter.result_value or 'Sin resultado'"/></td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">
                                            <t t-if="parameter.result_unit_selection == 'custom'">
                                                <span t-esc="parameter.custom_unit or ''"/>
                                            </t>
                                            <t t-elif="parameter.qualitative_unit_selection == 'custom'">
                                                <span t-esc="parameter.qualitative_custom_unit or ''"/>
                                            </t>
                                            <t t-else="">
                                                <span t-esc="parameter.unit or ''"/>
                                            </t>
                                        </td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">Límites del cliente</td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">
                                            <t t-if="parameter.analysis_date">
                                                <span t-esc="parameter.analysis_date.strftime('%d/%b/%Y')"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <td style="border: none; padding: 5px 3px; vertical-align: middle; text-align: center;">
                                            <t t-if="parameter.analyst_id">
                                                <span t-esc="parameter.analyst_id.initials or parameter.analyst_names or 'N/A'"/>
                                            </t>
                                            <t t-else="">
                                                <span t-esc="parameter.analyst_names or 'N/A'"/>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- INFORMACIÓN ADICIONAL -->
                        <div style="margin-top: 15px; font-size: 11px;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 11px; margin: 1px 0;">
                                <tr>
                                    <td style="width: 25%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Referencia normativa:</td>
                                    <td style="width: 75%; padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">Límites de referencia proporcionados por el cliente.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: right; font-weight: bold; font-size: 11px;">Observaciones analíticas y de resultados:</td>
                                    <td style="padding: 1px 2px; vertical-align: middle; line-height: 1.2; text-align: left;">
                                        <t t-set="all_notes" t-value="[]"/>
                                        <t t-foreach="analysis.parameter_analysis_ids" t-as="param">
                                            <t t-if="param.analyst_notes">
                                                <t t-set="all_notes" t-value="all_notes + [param.analyst_notes]"/>
                                            </t>
                                        </t>
                                        <t t-if="all_notes">
                                            <span t-esc="'; '.join(all_notes)"/>
                                        </t>
                                        <t t-else="">Sin observaciones.</t>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- NOTA FINAL -->
                        <div style="margin-top: 15px; font-size: 10px;">
                            <p><strong>Nota:</strong> Los resultados solo están relacionados con la porción de muestra analizada.</p>
                        </div>

                        <!-- SECCIÓN DE FIRMA -->
                        <div style="margin-top: 40px; text-align: right;">
                            <div style="width: 200px; margin-left: auto;">
                                <div style="border-bottom: 1px solid #000; margin-bottom: 8px; height: 50px;"></div>
                                <div style="text-align: center; font-size: 11px;">
                                    <strong>Bryan Manuel Zamora Luna</strong><br/>
                                    Aseguramiento de la Calidad
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========================================================= -->
    <!-- AGREGAR AQUÍ: TEMPLATE GENERAL SIN ILAC -->
    <!-- Ejemplo: <template id="report_general_no_ilac_template"> -->
    <!-- ========================================================= -->

    <!-- ========== REPORTE SIMPLIFICADO CON CADENA DE CUSTODIA ========== -->
    <template id="report_simplified_results_template">
        <t t-call="web.html_container">
            <meta charset="UTF-8"/>
            <t t-call-assets="web.report_assets_common" t-js="false"/>
            <t t-set="company" t-value="env.company"/>
            
            <!-- ESTILOS ESPECÍFICOS PARA REPORTE SIMPLIFICADO -->
            <style>
                body, .o_report_layout, table, td, th, span, div, p {
                    font-family: Arial, sans-serif !important;
                    font-size: 9px !important;  
                    line-height: 1.2;
                }
                .simplified-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 10px 0;
                    font-size: 8px !important;
                }
                .simplified-table th {
                    background-color: #e9ecef;
                    border: 1px solid #666;
                    padding: 4px 2px;
                    text-align: center;
                    font-weight: bold;
                    font-size: 8px !important;
                    word-wrap: break-word;
                }
                .simplified-table td {
                    border: 1px solid #ccc;
                    padding: 3px 2px;
                    vertical-align: top;
                    font-size: 8px !important;
                    word-wrap: break-word;
                }
                .header-section {
                    margin-bottom: 20px;
                    text-align: center;
                }
                .company-logo {
                    max-height: 60px;
                    max-width: 150px;
                }
                .title {
                    font-size: 16px !important;
                    font-weight: bold;
                    margin: 10px 0;
                }
                .date-section {
                    font-size: 10px !important;
                    margin: 5px 0;
                }
                .parameters-cell {
                    max-width: 120px;
                    word-wrap: break-word;
                    overflow-wrap: break-word;
                }
                .param-item {
                    margin-bottom: 8px;
                    padding: 3px;
                    background-color: #f8f9fa;
                    border-left: 3px solid #007bff;
                }
                .analyst-info {
                    color: #666;
                    font-style: italic;
                    font-size: 7px !important;
                }
            </style>

            <div class="page">
                <!-- HEADER -->
                <div class="header-section">
                    <t t-if="company.logo">
                        <img t-att-src="image_data_uri(company.logo)" class="company-logo"/>
                    </t>
                    <div class="title">
                        REPORTE SIMPLIFICADO DE RESULTADOS
                    </div>
                    <div class="date-section">
                        <t t-set="today" t-value="datetime.datetime.now()"/>
                        Fecha de Generación: <span t-esc="today.strftime('%d/%m/%Y %H:%M')"/>
                    </div>
                </div>

                <!-- TABLA PRINCIPAL CON CADENA DE CUSTODIA -->
                <table class="simplified-table">
                    <thead>
                        <tr>
                            <!-- INFORMACIÓN DEL CLIENTE Y MUESTRA -->
                            <th style="width: 9%;">Cliente</th>
                            <th style="width: 7%;">Cadena de Custodia</th>
                            <th style="width: 7%;">Código de Muestra</th>
                            <th style="width: 8%;">Identificación</th>
                            <th style="width: 6%;">Tipo de Muestra</th>
                            <th style="width: 5%;">Cantidad</th>
                            <th style="width: 6%;">Recipiente</th>
                            
                            <!-- INFORMACIÓN DE MUESTREO -->
                            <th style="width: 7%;">Fecha/Hora Muestreo</th>
                            <th style="width: 5%;">Temp. Muestreo</th>
                            <th style="width: 5%;">Muestreador</th>
                            
                            <!-- INFORMACIÓN DE RECOLECCIÓN -->
                            <th style="width: 7%;">Fecha/Hora Recolección</th>
                            <th style="width: 5%;">Temp. Recolección</th>
                            <th style="width: 5%;">Recolector</th>
                            
                            <!-- INFORMACIÓN DE RECEPCIÓN -->
                            <th style="width: 6%;">Fecha Recepción</th>
                            
                            <!-- RESULTADOS CON ANALISTAS POR PARÁMETRO -->
                            <th style="width: 12%;">Parámetros, Resultados y Analistas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="docs" t-as="analysis">
                            <!-- VARIABLES AUXILIARES -->
                            <t t-set="reception" t-value="analysis.sample_reception_id"/>
                            <t t-set="sample" t-value="reception.sample_id if reception else False"/>
                            
                            <tr>
                                <!-- CLIENTE Y MUESTRA -->
                                <td>
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.name"/>
                                    </t>
                                    <t t-else="">Sin cliente</t>
                                </td>
                                
                                <!-- ✅ CADENA DE CUSTODIA -->
                                <td>
                                    <t t-if="analysis.custody_chain_code">
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </t>
                                    <t t-else="">Sin cadena</t>
                                </td>
                                
                                <td>
                                    <t t-if="analysis.sample_code and analysis.sample_code != '/'">
                                        <span t-esc="analysis.sample_code"/>
                                    </t>
                                    <t t-else="">Pendiente</t>
                                </td>
                                
                                <td>
                                    <t t-if="analysis.sample_identifier">
                                        <span t-esc="analysis.sample_identifier"/>
                                    </t>
                                    <t t-else="">Sin identificación</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sample_type_id">
                                        <span t-esc="sample.sample_type_id.name"/>
                                    </t>
                                    <t t-else="">No especificado</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sample_quantity">
                                        <span t-esc="sample.sample_quantity"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.container_type_id">
                                        <span t-esc="sample.container_type_id.name"/>
                                    </t>
                                    <t t-else="">No especificado</t>
                                </td>
                                
                                <!-- MUESTREO -->
                                <td>
                                    <t t-if="sample and sample.sampling_date">
                                        <span t-esc="sample.sampling_date.strftime('%d/%m/%Y')"/>
                                        <t t-if="sample.sampling_time">
                                            <br/><span t-esc="sample.sampling_time"/>
                                        </t>
                                    </t>
                                    <t t-else="">No especificada</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sampling_temperature">
                                        <span t-esc="sample.sampling_temperature"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sampling_technician">
                                        <span t-esc="sample.sampling_technician"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- RECOLECCIÓN -->
                                <td>
                                    <t t-if="sample and sample.collection_date">
                                        <span t-esc="sample.collection_date.strftime('%d/%m/%Y')"/>
                                        <t t-if="sample.collection_time">
                                            <br/><span t-esc="sample.collection_time"/>
                                        </t>
                                    </t>
                                    <t t-else="">No especificada</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.collection_temperature">
                                        <span t-esc="sample.collection_temperature"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.collected_by">
                                        <span t-esc="sample.collected_by"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- RECEPCIÓN -->
                                <td>
                                    <t t-if="reception and reception.reception_date">
                                        <span t-esc="reception.reception_date.strftime('%d/%m/%Y')"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- PARÁMETROS CON ANALISTAS INDIVIDUALES -->
                                <td class="parameters-cell">
                                    <t t-if="analysis.parameter_analysis_ids">
                                        <t t-set="params_with_results" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.result_value and p.result_value.strip())"/>
                                        <t t-if="params_with_results">
                                            <t t-foreach="params_with_results" t-as="param">
                                                <div class="param-item">
                                                    <!-- NOMBRE DEL PARÁMETRO -->
                                                    <strong>
                                                        <span t-esc="param.microorganism or param.name or 'Sin nombre'"/>
                                                    </strong>
                                                    <br/>
                                                    
                                                    <!-- RESULTADO -->
                                                    <span t-esc="param.result_value"/>
                                                    <t t-if="param.unit">
                                                        <span t-esc="param.unit"/>
                                                    </t>
                                                    
                                                    <!-- ANALISTA RESPONSABLE DE ESTE PARÁMETRO -->
                                                    <t t-if="param.analyst_names">
                                                        <br/>
                                                        <span class="analyst-info">
                                                            👤 <span t-esc="param.analyst_names"/>
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <br/>
                                                        <span class="analyst-info">
                                                            👤 Sin asignar
                                                        </span>
                                                    </t>
                                                </div>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <div style="color: #999;">
                                                Parámetros sin resultados
                                            </div>
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <div style="color: #999;">
                                            Sin parámetros
                                        </div>
                                    </t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <!-- FOOTER CON INFORMACIÓN ADICIONAL -->
                <div style="margin-top: 20px; font-size: 8px; text-align: center; border-top: 1px solid #ccc; padding-top: 10px;">
                    <p><strong>Nota:</strong> Este es un reporte simplificado. Para información detallada consulte los informes individuales de cada muestra.</p>
                    <p>Generado el <span t-esc="datetime.datetime.now().strftime('%d/%m/%Y a las %H:%M')"/> por <span t-esc="env.user.name"/></p>
                </div>
            </div>
        </t>
    </template>


</odoo>