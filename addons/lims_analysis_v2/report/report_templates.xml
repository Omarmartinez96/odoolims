<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE PRELIMINAR -->
    <!-- Ejemplo: <template id="report_analysis_preliminary_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE FINAL -->
    <!-- Ejemplo: <template id="report_analysis_final_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE PARA FIRMA MANUAL -->
    <!-- Ejemplo: <template id="report_analysis_signing_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE BIOBURDEN -->
    <!-- Ejemplo: <template id="report_bioburden_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE PART√çCULAS VIABLES -->
    <!-- Ejemplo: <template id="report_viable_particles_template"> -->
    <!-- ========================================================= -->

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE ENDOTOXINAS -->
    <!-- Ejemplo: <template id="report_endotoxin_template"> -->
    <!-- ========================================================= -->

    <!-- ========== TEMPLATE GENERAL ILAC (MEJORADO CON NUEVOS AJUSTES) ========== -->
    <template id="report_general_ilac_template">
        <t t-call="web.html_container">
            <meta charset="UTF-8"/>
            <t t-call-assets="web.report_assets_common" t-js="false"/>
            <t t-set="company" t-value="env.company"/>
            
            <!-- ‚úÖ VARIABLES MOVIDAS FUERA DEL LOOP -->
            <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
            <t t-set="language" t-value="report_config.get('language', 'es')"/>
            <t t-set="status" t-value="report_config.get('status', 'final')"/>

            <!-- ESTILOS ESPEC√çFICOS PARA ILAC -->
            <style>
                body, .o_report_layout, table, td, th, span, div, p {
                    font-family: Arial, sans-serif !important;
                    font-size: 12px !important;  
                    line-height: 1.3;
                }
                .sample-break {
                    page-break-before: always;
                }
                .page-content {
                    page-break-inside: avoid;
                    min-height: 90vh;
                }
                .section-header {
                    background-color: rgb(218,227,243);
                    font-weight: bold;
                    padding: 6px;  
                    text-align: center;
                    font-size: 12px !important;  
                    margin: 10px 0 5px 0; 
                    page-break-inside: avoid;
                }
                .data-table {
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 11px !important; 
                    margin: 8px 0; 
                    page-break-inside: auto;
                    border: none !important;
                }
                .data-table th, .data-table td {
                    border: none !important;
                    padding: 5px 3px;  
                    vertical-align: top;
                    text-align: center;
                }
                .data-table th {
                    background-color: rgb(218,227,243);
                    font-weight: bold;
                    text-align: center;
                    font-size: 10px !important; 
                }
                .data-table tr {
                    page-break-inside: avoid;
                }
                .info-grid {
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 11px !important; 
                    margin: 1px 0;  
                }
                .info-grid td {
                    padding: 1px 2px;  
                    vertical-align: top;
                    line-height: 1.2;
                    text-align: left !important;  
                }
                .label {
                    font-weight: bold;
                    font-size: 11px !important; 
                }
                .info-grid .label {
                    text-align: right !important;
                }
                .two-column {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 8px 0;  
                    page-break-inside: avoid;
                }
                .two-column td {
                    width: 50%;
                    vertical-align: top;
                    padding: 0 8px; 
                }      
            </style>

            <!-- HEADER GLOBAL (FUERA DEL LOOP) -->
            <div class="header">
                <table class="header-table" style="height: 180px; border: none !important; border-collapse: collapse !important;">
                    <tr style="height: 150px; border: none !important;">
                        <!-- LOGO IZQUIERDA -->
                        <td style="width: 20%; text-align: left; vertical-align: middle; border: none !important; padding: 25px 15px;">
                            <img t-if="company.logo"
                                t-att-src="image_data_uri(company.logo)"
                                style="max-height: 140px; width: auto;"/>
                        </td>
                        
                        <!-- INFORMACI√ìN DEL LABORATORIO CENTRO -->
                        <td style="width: 60%; text-align: center; vertical-align: middle; border: none !important; padding: 25px 15px;">
                            <div style="text-align: center; font-family: Arial, sans-serif;">
                                <!-- Nombre del laboratorio - SIEMPRE EN ESPA√ëOL -->
                                <div style="font-size: 20px; font-weight: bold; color: #000; margin-bottom: 4px;">
                                    Laboratorio de Microbiolog√≠a
                                </div>
                                
                                <!-- Nombre PROTEUS - SIEMPRE IGUAL -->
                                <div style="font-size: 20px; font-weight: bold; color: #000; margin-bottom: 14px;">
                                    PROTEUS
                                </div>
                                
                                <!-- ‚úÖ TIPO DE REPORTE - SIN DEBUG -->
                                <div style="font-size: 16px; font-weight: bold; color: #000;">
                                    <t t-if="language == 'es'">INFORME DE ENSAYO</t>
                                    <t t-else="">TEST REPORT</t>
                                </div>
                            </div>
                        </td>
                        
                        <!-- LOGOS PLACEHOLDER DERECHA -->
                        <td style="width: 20%; text-align: right; vertical-align: middle; border: none !important; padding: 25px 15px !important;">
                            <div style="border: 1px solid #000; padding: 15px; min-height: 80px; display: flex; align-items: center; justify-content: center; font-size: 12px; width: 100%; box-sizing: border-box;">
                                [ILAC LOGOS]
                            </div>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- FOOTER GLOBAL (FUERA DEL LOOP) -->
            <div class="footer">
                <table style="width: 100%; font-size: 9px; margin: 0; padding: 0; border-top: 1px solid #000; font-family: Arial, sans-serif;">
                    <tr>
                        <td style="width: 33%; text-align: left; padding: 3px;">
                            Tel√©fono: (664) 973-8185
                        </td>
                        <td style="width: 33%; text-align: center; padding: 3px;">
                            FOR-022 Rev. 03 / PROC-006
                        </td>
                        <td style="width: 33%; text-align: right; padding: 3px;">
                            contacto@proteuslaboratorio.com
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            Av. Defensores de Baja California 2163 Plaza Marina Local 5-A, Empleado Postal, Tijuana B.C.
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            Documento controlado, prohibida su reproducci√≥n parcial o total sin autorizaci√≥n.
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 8px; padding: 2px;">
                            P√°gina <span class="page"/> de <span class="topage"/>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- CONTENIDO POR AN√ÅLISIS -->
            <t t-foreach="docs" t-as="analysis">

                <!-- CONTENIDO PRINCIPAL -->
                <div t-att-class="'page-content' + (' sample-break' if analysis_index > 0 else '')">
                    <div class="main-content" style="width: 100%; margin: 0; padding: 0;">

                        <!-- Badge preliminar si aplica -->
                        <t t-if="status == 'preliminary'">
                            <div style="text-align: center; margin: 15px 0;">
                                <span style="background-color: #ffc107; color: #212529; padding: 8px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">
                                    PRELIMINAR
                                </span>
                            </div>
                        </t>

                        <!-- INFORMACI√ìN SUPERIOR -->
                        <table class="info-grid" style="margin-top: 15px;">
                            <tr>
                                <td class="label" style="width: 25%;">
                                    <t t-if="language == 'es'">Identificaci√≥n de la muestra:</t>
                                    <t t-else="">Sample identification:</t>
                                </td>
                                <td style="width: 25%;"><span t-esc="analysis.sample_identifier or 'Sin identificaci√≥n'"/></td>
                                <td class="label" style="width: 25%;">
                                    <t t-if="language == 'es'">Fecha de emisi√≥n:</t>
                                    <t t-else="">Issue date:</t>
                                </td>
                                <td style="width: 25%;">
                                    <t t-set="today" t-value="datetime.datetime.now()"/>
                                    <span t-esc="today.strftime('%d/%b/%Y')"/>
                                </td>
                            </tr>
                            <tr>
                                <td class="label">
                                    <t t-if="language == 'es'">Descripci√≥n de la muestra:</t>
                                    <t t-else="">Sample description:</t>
                                </td>
                                <td>
                                    <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id">
                                        <span t-esc="analysis.sample_reception_id.sample_id.sample_description or 'Sin descripci√≥n'"/>
                                    </t>
                                    <t t-else="">Sin descripci√≥n</t>
                                </td>
                                <td class="label">
                                    <t t-if="language == 'es'">Cadena de custodia:</t>
                                    <t t-else="">Chain of custody:</t>
                                </td>
                                <td><span t-esc="analysis.custody_chain_code or 'Sin c√≥digo'"/></td>
                            </tr>
                        </table>

                        <!-- DATOS DEL CLIENTE -->
                        <div class="section-header">
                            <t t-if="language == 'es'">DATOS DEL CLIENTE</t>
                            <t t-else="">CUSTOMER DATA</t>
                        </div>
                        <table class="info-grid">
                            <tr>
                                <td class="label" style="width: 22%;">
                                    <t t-if="language == 'es'">Nombre o Raz√≥n social:</t>
                                    <t t-else="">Name or Company name:</t>
                                </td>
                                <td style="width: 78%;">
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.name"/>
                                    </t>
                                    <t t-else="">Sin cliente especificado</t>
                                </td>
                            </tr>
                            <tr>
                                <td class="label">
                                    <t t-if="language == 'es'">Direcci√≥n fiscal:</t>
                                    <t t-else="">Fiscal address:</t>
                                </td>
                                <td>
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.street or ''"/>
                                        <t t-if="analysis.customer_id.street2">, <span t-esc="analysis.customer_id.street2"/></t>
                                        <t t-if="analysis.customer_id.city">, <span t-esc="analysis.customer_id.city"/></t>
                                        <t t-if="analysis.customer_id.zip"> C.P. <span t-esc="analysis.customer_id.zip"/></t>
                                    </t>
                                    <t t-else="">Sin direcci√≥n</t>
                                </td>
                            </tr>
                            <tr>
                                <td class="label">
                                    <t t-if="language == 'es'">C√≥digo de cliente:</t>
                                    <t t-else="">Customer code:</t>
                                </td>
                                <td>
                                    <t t-if="analysis.customer_id and analysis.customer_id.client_code">
                                        <span t-esc="analysis.customer_id.client_code"/>
                                    </t>
                                    <t t-else="">N/A</t>
                                </td>
                            </tr>
                            <tr>
                                <td class="label">
                                    <t t-if="language == 'es'">Contacto:</t>
                                    <t t-else="">Contact:</t>
                                </td>
                                <td>
                                    <t t-if="analysis.custody_chain_id and analysis.custody_chain_id.contact_ids">
                                        <span t-esc="', '.join([c.name for c in analysis.custody_chain_id.contact_ids])"/>
                                    </t>
                                    <t t-else="">N/A</t>
                                </td>
                            </tr>
                        </table>

                        <!-- INFORMACI√ìN DE MUESTREO Y RECEPCI√ìN -->
                        <table class="two-column">
                            <tr>
                                <td>
                                    <div class="section-header">
                                        <t t-if="language == 'es'">INFORMACI√ìN DE MUESTREO</t>
                                        <t t-else="">SAMPLING INFORMATION</t>
                                    </div>
                                    <table class="info-grid">
                                        <tr>
                                            <td class="label" style="width: 45%;">
                                                <t t-if="language == 'es'">Fecha y hora de muestreo:</t>
                                                <t t-else="">Sampling date and time:</t>
                                            </td>
                                            <td style="width: 55%;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sampling_date">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sampling_date"/>
                                                </t>
                                                <t t-else="">-</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label">Tipo de muestra:</td>
                                            <td>
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.sample_id and analysis.sample_reception_id.sample_id.sample_type_id">
                                                    <span t-esc="analysis.sample_reception_id.sample_id.sample_type_id.name"/>
                                                </t>
                                                <t t-else="">Producto terminado</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label">Sitio de muestreo:</td>
                                            <td>Empresa</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Muestreador:</td>
                                            <td>Cliente</td>
                                        </tr>
                                        <tr>
                                            <td class="label">M√©todo/plan de muestreo (si aplica):</td>
                                            <td>N/A</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Observaciones:</td>
                                            <td>Muestra proporcionada por el cliente</td>
                                        </tr>
                                    </table>
                                </td>
                                
                                <td>
                                    <div class="section-header">
                                        <t t-if="language == 'es'">INFORMACI√ìN DE RECEPCI√ìN</t>
                                        <t t-else="">RECEPTION INFORMATION</t>
                                    </div>
                                    <table class="info-grid">
                                        <tr>
                                            <td class="label" style="width: 45%;">Fecha y hora de recepci√≥n:</td>
                                            <td style="width: 55%;">
                                                <t t-if="analysis.sample_reception_id and analysis.sample_reception_id.reception_date">
                                                    <span t-esc="analysis.sample_reception_id.reception_date.strftime('%d/%b/%Y')"/>
                                                </t>
                                                <t t-else="">-</t>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="label">Clave de la muestra:</td>
                                            <td><span t-esc="analysis.sample_code or 'Sin c√≥digo'"/></td>
                                        </tr>
                                        <tr>
                                            <td class="label">Cantidad de muestra:</td>
                                            <td>100g</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Temperatura de recepci√≥n:</td>
                                            <td>-</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Recipiente de la muestra:</td>
                                            <td>Envase original</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Recibi√≥:</td>
                                            <td>Daniela Rangel</td>
                                        </tr>
                                        <tr>
                                            <td class="label">Observaciones:</td>
                                            <td>Sin observaciones</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>

                        <!-- DATOS DEL AN√ÅLISIS -->
                        <div class="section-header">DATOS DEL AN√ÅLISIS</div>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 14%;">Par√°metro</th>
                                    <th style="width: 18%;">M√©todo</th>
                                    <th style="width: 3%;">C</th>
                                    <th style="width: 3%;">T</th>
                                    <th style="width: 4%;">LAB</th>
                                    <th style="width: 12%;">Resultado</th>
                                    <th style="width: 10%;">Unidades</th>
                                    <th style="width: 12%;">Referencia</th>
                                    <th style="width: 10%;">Fecha de an√°lisis</th>
                                    <th style="width: 4%;">AN</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="analysis_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                                <t t-foreach="analysis_params" t-as="parameter">
                                    <tr>
                                        <td><span t-esc="parameter.microorganism or parameter.name or 'Sin nombre'"/></td>
                                        <td><span t-esc="parameter.method or 'No especificado'"/></td>
                                        <td>C</td>
                                        <td>T</td>
                                        <td>LAB</td>
                                        <td><span t-esc="parameter.result_value or 'Sin resultado'"/></td>
                                        <td>
                                            <t t-if="parameter.result_unit_selection == 'custom'">
                                                <span t-esc="parameter.custom_unit or ''"/>
                                            </t>
                                            <t t-elif="parameter.qualitative_unit_selection == 'custom'">
                                                <span t-esc="parameter.qualitative_custom_unit or ''"/>
                                            </t>
                                            <t t-else="">
                                                <span t-esc="parameter.unit or ''"/>
                                            </t>
                                        </td>
                                        <td>L√≠mites del cliente</td>
                                        <td>
                                            <t t-if="parameter.analysis_date">
                                                <span t-esc="parameter.analysis_date.strftime('%d/%b/%Y')"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <td><span t-esc="parameter.analyst_names or 'N/A'"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- INFORMACI√ìN ADICIONAL -->
                        <div style="margin-top: 15px; font-size: 11px;">
                            <table class="info-grid">
                                <tr>
                                    <td class="label" style="width: 25%;">Referencia normativa:</td>
                                    <td style="width: 75%;">L√≠mites de referencia proporcionados por el cliente.</td>
                                </tr>
                                <tr>
                                    <td class="label">Observaciones anal√≠ticas y de resultados:</td>
                                    <td>Sin observaciones.</td>
                                </tr>
                            </table>
                        </div>

                        <!-- NOTA FINAL -->
                        <div style="margin-top: 15px; font-size: 10px;">
                            <p><strong>Nota:</strong> Los resultados solo est√°n relacionados con la porci√≥n de muestra analizada.</p>
                        </div>

                        <!-- SECCI√ìN DE FIRMA -->
                        <div style="margin-top: 40px; text-align: right;">
                            <div style="width: 200px; margin-left: auto;">
                                <div style="border-bottom: 1px solid #000; margin-bottom: 8px; height: 50px;"></div>
                                <div style="text-align: center; font-size: 11px;">
                                    <strong>Bryan Manuel Zamora Luna</strong><br/>
                                    Aseguramiento de la Calidad
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========================================================= -->
    <!-- AGREGAR AQU√ç: TEMPLATE GENERAL SIN ILAC -->
    <!-- Ejemplo: <template id="report_general_no_ilac_template"> -->
    <!-- ========================================================= -->

    <!-- ========== REPORTE SIMPLIFICADO REESTRUCTURADO ========== -->
    <template id="report_simplified_results_template">
        <t t-call="web.html_container">
            <meta charset="UTF-8"/>
            <t t-call-assets="web.report_assets_common" t-js="false"/>
            <t t-set="company" t-value="env.company"/>
            
            <!-- ESTILOS ESPEC√çFICOS PARA REPORTE SIMPLIFICADO -->
            <style>
                body, .o_report_layout, table, td, th, span, div, p {
                    font-family: Arial, sans-serif !important;
                    font-size: 9px !important;  
                    line-height: 1.2;
                }
                .simplified-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 10px 0;
                    font-size: 8px !important;
                }
                .simplified-table th {
                    background-color: #e9ecef;
                    border: 1px solid #666;
                    padding: 4px 2px;
                    text-align: center;
                    font-weight: bold;
                    font-size: 8px !important;
                    word-wrap: break-word;
                }
                .simplified-table td {
                    border: 1px solid #ccc;
                    padding: 3px 2px;
                    vertical-align: top;
                    font-size: 8px !important;
                    word-wrap: break-word;
                }
                .header-section {
                    margin-bottom: 20px;
                    text-align: center;
                }
                .company-logo {
                    max-height: 60px;
                    max-width: 150px;
                }
                .title {
                    font-size: 16px !important;
                    font-weight: bold;
                    margin: 10px 0;
                }
                .date-section {
                    font-size: 10px !important;
                    margin: 5px 0;
                }
                .parameters-cell {
                    max-width: 140px;
                    word-wrap: break-word;
                    overflow-wrap: break-word;
                }
                .param-item {
                    margin-bottom: 8px;
                    padding: 3px;
                    background-color: #f8f9fa;
                    border-left: 3px solid #007bff;
                }
                .analyst-info {
                    color: #666;
                    font-style: italic;
                    font-size: 7px !important;
                }
            </style>

            <div class="page">
                <!-- HEADER -->
                <div class="header-section">
                    <t t-if="company.logo">
                        <img t-att-src="image_data_uri(company.logo)" class="company-logo"/>
                    </t>
                    <div class="title">
                        REPORTE SIMPLIFICADO DE RESULTADOS
                    </div>
                    <div class="date-section">
                        <t t-set="today" t-value="datetime.datetime.now()"/>
                        Fecha de Generaci√≥n: <span t-esc="today.strftime('%d/%m/%Y %H:%M')"/>
                    </div>
                </div>

                <!-- TABLA PRINCIPAL REESTRUCTURADA -->
                <table class="simplified-table">
                    <thead>
                        <tr>
                            <!-- INFORMACI√ìN DEL CLIENTE Y MUESTRA -->
                            <th style="width: 10%;">Cliente</th>
                            <th style="width: 8%;">C√≥digo de Muestra</th>
                            <th style="width: 10%;">Identificaci√≥n</th>
                            <th style="width: 8%;">Tipo de Muestra</th>
                            <th style="width: 6%;">Cantidad</th>
                            <th style="width: 8%;">Recipiente</th>
                            
                            <!-- INFORMACI√ìN DE MUESTREO -->
                            <th style="width: 8%;">Fecha/Hora Muestreo</th>
                            <th style="width: 6%;">Temp. Muestreo</th>
                            <th style="width: 6%;">Muestreador</th>
                            
                            <!-- INFORMACI√ìN DE RECOLECCI√ìN -->
                            <th style="width: 8%;">Fecha/Hora Recolecci√≥n</th>
                            <th style="width: 6%;">Temp. Recolecci√≥n</th>
                            <th style="width: 6%;">Recolector</th>
                            
                            <!-- INFORMACI√ìN DE RECEPCI√ìN (SIN ANALISTA) -->
                            <th style="width: 8%;">Fecha Recepci√≥n</th>
                            
                            <!-- ‚úÖ RESULTADOS CON ANALISTAS POR PAR√ÅMETRO -->
                            <th style="width: 12%;">Par√°metros, Resultados y Analistas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="docs" t-as="analysis">
                            <!-- VARIABLES AUXILIARES -->
                            <t t-set="reception" t-value="analysis.sample_reception_id"/>
                            <t t-set="sample" t-value="reception.sample_id if reception else False"/>
                            
                            <tr>
                                <!-- CLIENTE Y MUESTRA -->
                                <td>
                                    <t t-if="analysis.customer_id">
                                        <span t-esc="analysis.customer_id.name"/>
                                    </t>
                                    <t t-else="">Sin cliente</t>
                                </td>
                                
                                <td>
                                    <t t-if="analysis.sample_code and analysis.sample_code != '/'">
                                        <span t-esc="analysis.sample_code"/>
                                    </t>
                                    <t t-else="">Pendiente</t>
                                </td>
                                
                                <td>
                                    <t t-if="analysis.sample_identifier">
                                        <span t-esc="analysis.sample_identifier"/>
                                    </t>
                                    <t t-else="">Sin identificaci√≥n</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sample_type_id">
                                        <span t-esc="sample.sample_type_id.name"/>
                                    </t>
                                    <t t-else="">No especificado</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sample_quantity">
                                        <span t-esc="sample.sample_quantity"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.container_type_id">
                                        <span t-esc="sample.container_type_id.name"/>
                                    </t>
                                    <t t-else="">No especificado</t>
                                </td>
                                
                                <!-- MUESTREO -->
                                <td>
                                    <t t-if="sample and sample.sampling_date">
                                        <span t-esc="sample.sampling_date.strftime('%d/%m/%Y')"/>
                                        <t t-if="sample.sampling_time">
                                            <br/><span t-esc="sample.sampling_time"/>
                                        </t>
                                    </t>
                                    <t t-else="">No especificada</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sampling_temperature">
                                        <span t-esc="sample.sampling_temperature"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.sampling_technician">
                                        <span t-esc="sample.sampling_technician"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- RECOLECCI√ìN -->
                                <td>
                                    <t t-if="sample and sample.collection_date">
                                        <span t-esc="sample.collection_date.strftime('%d/%m/%Y')"/>
                                        <t t-if="sample.collection_time">
                                            <br/><span t-esc="sample.collection_time"/>
                                        </t>
                                    </t>
                                    <t t-else="">No especificada</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.collection_temperature">
                                        <span t-esc="sample.collection_temperature"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <td>
                                    <t t-if="sample and sample.collected_by">
                                        <span t-esc="sample.collected_by"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- ‚úÖ RECEPCI√ìN SIN ANALISTA -->
                                <td>
                                    <t t-if="reception and reception.reception_date">
                                        <span t-esc="reception.reception_date.strftime('%d/%m/%Y')"/>
                                    </t>
                                    <t t-else="">-</t>
                                </td>
                                
                                <!-- ‚úÖ PAR√ÅMETROS CON ANALISTAS INDIVIDUALES -->
                                <td class="parameters-cell">
                                    <t t-if="analysis.parameter_analysis_ids">
                                        <t t-set="params_with_results" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.result_value and p.result_value.strip())"/>
                                        <t t-if="params_with_results">
                                            <t t-foreach="params_with_results" t-as="param">
                                                <div class="param-item">
                                                    <!-- NOMBRE DEL PAR√ÅMETRO -->
                                                    <strong>
                                                        <span t-esc="param.microorganism or param.name or 'Sin nombre'"/>
                                                    </strong>
                                                    <br/>
                                                    
                                                    <!-- RESULTADO -->
                                                    <span t-esc="param.result_value"/>
                                                    <t t-if="param.unit">
                                                        <span t-esc="param.unit"/>
                                                    </t>
                                                    
                                                    <!-- ‚úÖ ANALISTA RESPONSABLE DE ESTE PAR√ÅMETRO -->
                                                    <t t-if="param.analyst_names">
                                                        <br/>
                                                        <span class="analyst-info">
                                                            üë§ <span t-esc="param.analyst_names"/>
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <br/>
                                                        <span class="analyst-info">
                                                            üë§ Sin asignar
                                                        </span>
                                                    </t>
                                                </div>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <div style="color: #999;">
                                                Par√°metros sin resultados
                                            </div>
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <div style="color: #999;">
                                            Sin par√°metros
                                        </div>
                                    </t>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <!-- FOOTER CON INFORMACI√ìN ADICIONAL -->
                <div style="margin-top: 20px; font-size: 8px; text-align: center; border-top: 1px solid #ccc; padding-top: 10px;">
                    <p><strong>Nota:</strong> Este es un reporte simplificado. Para informaci√≥n detallada consulte los informes individuales de cada muestra.</p>
                    <p>Generado el <span t-esc="datetime.datetime.now().strftime('%d/%m/%Y a las %H:%M')"/> por <span t-esc="env.user.name"/></p>
                </div>
            </div>
        </t>
    </template>


</odoo>