<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ========== TEMPLATE BASE COMPARTIDO ========== -->
    <template id="report_analysis_base_template">
        <t t-call="web.html_container">
            <meta charset="UTF-8"/>
            <t t-call-assets="web.report_assets_common" t-js="false"/>
            <t t-set="company" t-value="env.company"/>

            <!-- ESTILOS LOCALES -->
            <style>
                body, .o_report_layout, table, td, th, span, div, p {
                    font-family: "DejaVu Sans", sans-serif !important;
                }
                .sample-section {
                    margin-top: 20px;
                    border: 2px solid #2c5aa0;
                    padding: 15px;
                    background-color: #f8f9fa;
                    page-break-inside: avoid;
                }
                .parameter-row {
                    background-color: #e8f4fd;
                    font-size: 11px;
                }
                .result-row {
                    font-size: 12px;
                }
                .header-title {
                    background-color: #2c5aa0;
                    color: white;
                    padding: 8px;
                    text-align: center;
                    font-weight: bold;
                }
                .authorization-section {
                    margin-top: 30px;
                    border: 2px solid #28a745;
                    padding: 15px;
                    background-color: #f8fff8;
                }
                .revision-badge {
                    background-color: #17a2b8;
                    color: white;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-weight: bold;
                }
                .preliminary-badge {
                    background-color: #ffc107;
                    color: #212529;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-weight: bold;
                }
                .final-badge {
                    background-color: #28a745;
                    color: white;
                    padding: 5px 10px;
                    border-radius: 5px;
                    font-weight: bold;
                }
            </style>

            <!-- HEADER SOLO CON LOGO -->
            <div class="header" style="padding: 10px 20px;">
                <img t-if="company.logo"
                    t-att-src="image_data_uri(company.logo)"
                    style="max-height: 120px; width: auto;"/>
            </div>

            <!-- FOOTER FIJO -->
            <div class="footer">
                <table class="table table-borderless" style="width: 100%; font-size: 10px; border-top: 1px solid #ddd; padding-top: 5px;">
                    <tr>
                        <td style="width: 33%; text-align: left; padding: 3px;">
                            Teléfono: (664) 973-8185
                        </td>
                        <td style="width: 33%; text-align: center; padding: 3px;">
                            FOR-021 Rev. 01 | PROC-005
                        </td>
                        <td style="width: 33%; text-align: right; padding: 3px;">
                            contacto@proteuslaboratorio.com
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 9px; padding: 2px;">
                            <t t-if="company.partner_id">
                                <t t-esc="company.partner_id.name"/>,
                                <t t-if="company.partner_id.street" t-esc="company.partner_id.street"/>
                                <t t-if="company.partner_id.street2">, <t t-esc="company.partner_id.street2"/></t>,
                                <t t-if="company.partner_id.city" t-esc="company.partner_id.city"/>,
                                <t t-if="company.partner_id.zip">C.P. <t t-esc="company.partner_id.zip"/></t>,
                                <t t-if="company.partner_id.country_id" t-esc="company.partner_id.country_id.name"/>
                            </t>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center; font-size: 9px; padding: 2px;">
                            Página <span class="page"/> / <span class="topage"/>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- CONTENIDO DINÁMICO -->
            <t t-raw="0"/>
        </t>
    </template>

    <!-- ========== TEMPLATE PRELIMINAR ========== -->
    <template id="report_analysis_preliminary_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">

                        <!-- Título principal -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                REPORTE PRELIMINAR DE RESULTADOS
                                <t t-if="analysis.is_revision and analysis.revision_number > 0">
                                    <br/><span class="revision-badge">REVISIÓN N° <t t-esc="analysis.revision_number"/></span>
                                </t>
                            </h1>
                        </div>

                        <!-- Información del reporte -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>Cadena de Custodia:</strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>Fecha de emisión:</strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Cliente:</strong> <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <span class="preliminary-badge">PRELIMINAR</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Muestra:</strong> <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>Fecha de Recepción:</strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Nota preliminar -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                            <strong>📋 NOTA:</strong> Este es un reporte preliminar que contiene resultados parciales disponibles. 
                            Los resultados pueden estar sujetos a cambios en el reporte final.
                        </div>

                        <!-- Resultados de la muestra -->
                        <div class="sample-section">
                            
                            <!-- Header de la muestra -->
                            <div class="header-title">
                                Muestra: <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Información básica -->
                            <table class="table table-borderless" style="width:100%; font-size:12px; margin: 10px 0;">
                                <tbody>
                                    <tr>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Descripción:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_description or 'No especificada'"/>
                                        </td>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Tipo:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_type_id.name or 'No especificado'"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:3px;">
                                            <strong>Fecha de Análisis:</strong> 
                                            <t t-if="analysis.analysis_start_date">
                                                <t t-set="a_date" t-value="analysis.analysis_start_date"/>
                                                <t t-set="d_analysis" t-value="a_date.strftime('%d')"/>
                                                <t t-set="m_analysis" t-value="a_date.strftime('%m')"/>
                                                <t t-set="y_analysis" t-value="a_date.strftime('%Y')"/>
                                                <span t-esc="d_analysis + '/' + meses[m_analysis] + '/' + y_analysis"/>
                                            </t>
                                            <span t-else="">No especificada</span>
                                        </td>
                                        <td style="padding:3px;">
                                            <strong>Parámetros Listos:</strong> 
                                            <span t-esc="analysis.ready_parameters_count"/> de <span t-esc="analysis.total_parameters_count"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Tabla de resultados LISTOS -->
                            <t t-set="ready_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.report_status == 'ready')"/>
                            
                            <t t-if="ready_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">Resultados Preliminares:</h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#2c5aa0; color: white;">
                                            <th style="padding:8px; text-align:left; width:25%;">Parámetro</th>
                                            <th style="padding:8px; text-align:left; width:25%;">Método</th>
                                            <th style="padding:8px; text-align:center; width:20%;">Resultado</th>
                                            <th style="padding:8px; text-align:left; width:30%;">Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="ready_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <t t-if="parameter.microorganism">
                                                        <strong><span t-esc="parameter.microorganism"/></strong>
                                                    </t>
                                                    <t t-else="">
                                                        <strong><span t-esc="parameter.name or 'Sin nombre'"/></strong>
                                                    </t>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        No hay resultados preliminares disponibles para esta muestra.
                                    </p>
                                </div>
                            </t>

                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>Tipo de Reporte:</strong> Este es un reporte preliminar que contiene resultados parciales disponibles a la fecha de emisión.
                                Los resultados están sujetos a verificación y pueden cambiar en el reporte final.
                            </p>
                            <p style="margin-top: 10px;">
                                <em>Los análisis se realizaron conforme a los métodos indicados y bajo las condiciones establecidas en nuestros procedimientos de calidad.</em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE FINAL ========== -->
    <template id="report_analysis_final_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">

                        <!-- Título principal -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                REPORTE FINAL DE RESULTADOS DE ANÁLISIS
                                <t t-if="analysis.is_revision and analysis.revision_number > 0">
                                    <br/><span class="revision-badge">REVISIÓN N° <t t-esc="analysis.revision_number"/></span>
                                </t>
                            </h1>
                        </div>

                        <!-- Información del reporte -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>Cadena de Custodia:</strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>Fecha de emisión:</strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Cliente:</strong> <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <span class="final-badge">FINAL</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Muestra:</strong> <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>Fecha de Recepción:</strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados de la muestra -->
                        <div class="sample-section">
                            
                            <!-- Header de la muestra -->
                            <div class="header-title">
                                Muestra: <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Información básica -->
                            <table class="table table-borderless" style="width:100%; font-size:12px; margin: 10px 0;">
                                <tbody>
                                    <tr>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Descripción:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_description or 'No especificada'"/>
                                        </td>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Tipo:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_type_id.name or 'No especificado'"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:3px;">
                                            <strong>Fecha de Análisis:</strong> 
                                            <t t-if="analysis.analysis_start_date">
                                                <t t-set="a_date" t-value="analysis.analysis_start_date"/>
                                                <t t-set="d_analysis" t-value="a_date.strftime('%d')"/>
                                                <t t-set="m_analysis" t-value="a_date.strftime('%m')"/>
                                                <t t-set="y_analysis" t-value="a_date.strftime('%Y')"/>
                                                <span t-esc="d_analysis + '/' + meses[m_analysis] + '/' + y_analysis"/>
                                            </t>
                                            <span t-else="">No especificada</span>
                                        </td>
                                        <td style="padding:3px;">
                                            <strong>Estado:</strong> 
                                            <span style="color: #28a745; font-weight: bold;">✅ Análisis Completo</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Tabla de resultados TODOS -->
                            <t t-set="all_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.report_status in ['ready', 'reported'])"/>
                            
                            <t t-if="all_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">Resultados Finales:</h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#2c5aa0; color: white;">
                                            <th style="padding:8px; text-align:left; width:25%;">Parámetro</th>
                                            <th style="padding:8px; text-align:left; width:25%;">Método</th>
                                            <th style="padding:8px; text-align:center; width:20%;">Resultado</th>
                                            <th style="padding:8px; text-align:left; width:30%;">Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="all_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <t t-if="parameter.microorganism">
                                                        <strong><span t-esc="parameter.microorganism"/></strong>
                                                    </t>
                                                    <t t-else="">
                                                        <strong><span t-esc="parameter.name or 'Sin nombre'"/></strong>
                                                    </t>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>

                        </div>

                        <!-- SECCIÓN DE FIRMA DE MUESTRA (SOLO SI ESTÁ FIRMADA) -->
                        <t t-if="analysis.signature_state == 'signed'">
                            <div class="authorization-section" style="border-color: #007bff; background-color: #f8f9ff;">
                                <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #007bff; text-align: center;">
                                    FIRMA DE MUESTRA - <span t-esc="analysis.sample_code"/>
                                </h3>
                                
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr>
                                        <td style="width: 50%; vertical-align: top; padding: 10px; text-align: center;">
                                            <t t-if="analysis.sample_digital_signature">
                                                <img t-att-src="image_data_uri(analysis.sample_digital_signature)" 
                                                    style="max-width: 200px; max-height: 100px; border: 1px solid #007bff; padding: 5px;"/>
                                            </t>
                                            <div style="margin-top: 10px; border-top: 2px solid #007bff; padding-top: 5px;">
                                                <strong>Firma de Muestra</strong>
                                            </div>
                                        </td>
                                        <td style="width: 50%; vertical-align: top; padding: 10px;">
                                            <div style="font-size: 12px; line-height: 1.6;">
                                                <p><strong>Firmado por:</strong> <span t-esc="analysis.sample_signature_name or 'No especificado'"/></p>
                                                <p><strong>Cargo:</strong> <span t-esc="analysis.sample_signature_position or 'No especificado'"/></p>
                                                <p><strong>Fecha de Firma:</strong> 
                                                    <t t-if="analysis.sample_signature_date">
                                                        <t t-set="sign_date" t-value="analysis.sample_signature_date"/>
                                                        <t t-set="d_sign" t-value="sign_date.strftime('%d')"/>
                                                        <t t-set="m_sign" t-value="sign_date.strftime('%m')"/>
                                                        <t t-set="y_sign" t-value="sign_date.strftime('%Y')"/>
                                                        <t t-set="h_sign" t-value="sign_date.strftime('%H:%M')"/>
                                                        <span t-esc="d_sign + '/' + meses[m_sign] + '/' + y_sign + ' ' + h_sign"/>
                                                    </t>
                                                    <span t-else="">No especificada</span>
                                                </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>Tipo de Reporte:</strong> Este es un reporte final que contiene todos los resultados solicitados para las muestras analizadas.
                            </p>
                            <p style="margin-top: 10px;">
                                <em>Los análisis se realizaron conforme a los métodos indicados y bajo las condiciones establecidas en nuestros procedimientos de calidad.</em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE PARA FIRMA MANUAL ========== -->
    <template id="report_analysis_signing_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">

                        <!-- Título principal -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                INFORME PARA FIRMA AUTÓGRAFA
                                <t t-if="analysis.is_revision and analysis.revision_number > 0">
                                    <br/><span class="revision-badge">REVISIÓN N° <t t-esc="analysis.revision_number"/></span>
                                </t>
                            </h1>
                        </div>

                        <!-- Información del reporte -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>Cadena de Custodia:</strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>Fecha de emisión:</strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Cliente:</strong> <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <span style="background-color: #6c757d; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">PARA FIRMA MANUAL</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Muestra:</strong> <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>Fecha de Recepción:</strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados de la muestra -->
                        <div class="sample-section">
                            
                            <!-- Header de la muestra -->
                            <div class="header-title">
                                Muestra: <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Información básica -->
                            <table class="table table-borderless" style="width:100%; font-size:12px; margin: 10px 0;">
                                <tbody>
                                    <tr>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Descripción:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_description or 'No especificada'"/>
                                        </td>
                                        <td style="width:50%; padding:3px;">
                                            <strong>Tipo:</strong> 
                                            <span t-esc="analysis.sample_reception_id.sample_id.sample_type_id.name or 'No especificado'"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding:3px;">
                                            <strong>Fecha de Análisis:</strong> 
                                            <t t-if="analysis.analysis_start_date">
                                                <t t-set="a_date" t-value="analysis.analysis_start_date"/>
                                                <t t-set="d_analysis" t-value="a_date.strftime('%d')"/>
                                                <t t-set="m_analysis" t-value="a_date.strftime('%m')"/>
                                                <t t-set="y_analysis" t-value="a_date.strftime('%Y')"/>
                                                <span t-esc="d_analysis + '/' + meses[m_analysis] + '/' + y_analysis"/>
                                            </t>
                                            <span t-else="">No especificada</span>
                                        </td>
                                        <td style="padding:3px;">
                                            <strong>Estado:</strong> 
                                            <span style="color: #28a745; font-weight: bold;">✅ Firmado Digitalmente</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- Tabla de resultados -->
                            <t t-set="all_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.report_status in ['ready', 'reported'])"/>
                            
                            <t t-if="all_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">Resultados:</h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#2c5aa0; color: white;">
                                            <th style="padding:8px; text-align:left; width:25%;">Parámetro</th>
                                            <th style="padding:8px; text-align:left; width:25%;">Método</th>
                                            <th style="padding:8px; text-align:center; width:20%;">Resultado</th>
                                            <th style="padding:8px; text-align:left; width:30%;">Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="all_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <t t-if="parameter.microorganism">
                                                        <strong><span t-esc="parameter.microorganism"/></strong>
                                                    </t>
                                                    <t t-else="">
                                                        <strong><span t-esc="parameter.name or 'Sin nombre'"/></strong>
                                                    </t>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>

                        </div>

                        <!-- SECCIÓN PARA FIRMA MANUAL -->
                        <t t-if="analysis.signature_state == 'signed'">
                            <div class="authorization-section" style="border-color: #6c757d; background-color: #f8f9fa;">
                                <h3 style="font-size: 16px; margin: 0 0 15px 0; color: #6c757d; text-align: center;">
                                    ESPACIO PARA FIRMA AUTÓGRAFA - <span t-esc="analysis.sample_code"/>
                                </h3>
                                
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr>
                                        <td style="width: 50%; vertical-align: top; padding: 10px; text-align: center;">
                                            <div style="border: 2px solid #6c757d; height: 100px; width: 200px; margin: 0 auto; background-color: white;">
                                                <div style="text-align: center; padding-top: 40px; color: #6c757d; font-style: italic;">
                                                    Espacio para firma autógrafa
                                                </div>
                                            </div>
                                            <div style="margin-top: 10px; border-top: 2px solid #6c757d; padding-top: 5px;">
                                                <strong>Firma Manual</strong>
                                            </div>
                                        </td>
                                        <td style="width: 50%; vertical-align: top; padding: 10px;">
                                            <div style="font-size: 12px; line-height: 1.6;">
                                                <p><strong>Firmado por:</strong> <span t-esc="analysis.sample_signature_name or 'No especificado'"/></p>
                                                <p><strong>Cargo:</strong> <span t-esc="analysis.sample_signature_position or 'No especificado'"/></p>
                                                <p><strong>Fecha de Firma Digital:</strong> 
                                                    <t t-if="analysis.sample_signature_date">
                                                        <t t-set="sign_date" t-value="analysis.sample_signature_date"/>
                                                        <t t-set="d_sign" t-value="sign_date.strftime('%d')"/>
                                                        <t t-set="m_sign" t-value="sign_date.strftime('%m')"/>
                                                        <t t-set="y_sign" t-value="sign_date.strftime('%Y')"/>
                                                        <t t-set="h_sign" t-value="sign_date.strftime('%H:%M')"/>
                                                        <span t-esc="d_sign + '/' + meses[m_sign] + '/' + y_sign + ' ' + h_sign"/>
                                                    </t>
                                                </p>
                                                <p style="margin-top: 20px;"><strong>Fecha de Firma Manual:</strong> _______________</p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </t>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>Nota:</strong> Este informe ha sido firmado digitalmente y se presenta para firma autógrafa adicional según requerimientos específicos.
                            </p>
                            <p style="margin-top: 10px;">
                                <em>Los análisis se realizaron conforme a los métodos indicados y bajo las condiciones establecidas en nuestros procedimientos de calidad.</em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE BIOBURDEN ========== -->
    <template id="report_bioburden_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">
                        
                        <!-- Variables de configuración -->
                        <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
                        <t t-set="language" t-value="report_config.get('language', 'es')"/>
                        <t t-set="status" t-value="report_config.get('status', 'final')"/>
                        
                        <!-- Título según idioma y estado -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                <t t-if="language == 'es' and status == 'final'">
                                    INFORME DE ENSAYO - BIOBURDEN
                                </t>
                                <t t-elif="language == 'es' and status == 'preliminary'">
                                    INFORME PRELIMINAR - BIOBURDEN
                                </t>
                                <t t-elif="language == 'en' and status == 'final'">
                                    TEST REPORT - BIOBURDEN
                                </t>
                                <t t-elif="language == 'en' and status == 'preliminary'">
                                    PRELIMINARY TEST REPORT - BIOBURDEN
                                </t>
                            </h1>
                        </div>

                        <!-- Badge especial para Bioburden -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #e8f5e8; border: 2px solid #28a745; border-radius: 10px;">
                            <h2 style="color: #28a745; margin: 0;">
                                🦠 
                                <t t-if="language == 'es'">ENSAYO DE BIOCARGA</t>
                                <t t-else="">BIOBURDEN ASSAY</t>
                            </h2>
                            <p style="margin: 5px 0 0 0; font-style: italic;">
                                <t t-if="language == 'es'">Recuento de microorganismos viables</t>
                                <t t-else="">Viable microorganism count</t>
                            </p>
                        </div>

                        <!-- Información básica (copiado del template final) -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>Cadena de Custodia:</strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>Fecha de emisión:</strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Cliente:</strong> <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <t t-if="status == 'preliminary'">
                                            <span class="preliminary-badge">PRELIMINAR</span>
                                        </t>
                                        <t t-else="">
                                            <span class="final-badge">FINAL</span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>Muestra:</strong> <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>Fecha de Recepción:</strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados específicos de Bioburden -->
                        <div class="sample-section">
                            <div class="header-title">
                                Muestra: <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Filtrar solo parámetros microbiológicos -->
                            <t t-set="bioburden_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: p.category == 'microbiological' and (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                            
                            <t t-if="bioburden_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">Resultados de Biocarga:</h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#28a745; color: white;">
                                            <th style="padding:8px; text-align:left; width:30%;">Microorganismo</th>
                                            <th style="padding:8px; text-align:left; width:25%;">Método</th>
                                            <th style="padding:8px; text-align:center; width:20%;">Resultado</th>
                                            <th style="padding:8px; text-align:left; width:25%;">Observaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="bioburden_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <strong>
                                                        <span t-esc="parameter.microorganism or parameter.name or 'Sin especificar'"/>
                                                    </strong>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold; color: #28a745;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        No hay resultados de biocarga disponibles.
                                    </p>
                                </div>
                            </t>
                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>Método de Ensayo:</strong> Recuento en placa según normas farmacéuticas aplicables.
                            </p>
                            <p style="margin-top: 10px;">
                                <em>Los análisis se realizaron bajo condiciones controladas y según procedimientos validados.</em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE PARTÍCULAS VIABLES ========== -->
    <template id="report_viable_particles_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">
                        
                        <!-- Variables de configuración -->
                        <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
                        <t t-set="language" t-value="report_config.get('language', 'es')"/>
                        <t t-set="status" t-value="report_config.get('status', 'final')"/>
                        
                        <!-- Título según idioma y estado -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                <t t-if="language == 'es' and status == 'final'">
                                    INFORME DE ENSAYO - PARTÍCULAS VIABLES
                                </t>
                                <t t-elif="language == 'es' and status == 'preliminary'">
                                    INFORME PRELIMINAR - PARTÍCULAS VIABLES
                                </t>
                                <t t-elif="language == 'en' and status == 'final'">
                                    TEST REPORT - VIABLE PARTICLES
                                </t>
                                <t t-elif="language == 'en' and status == 'preliminary'">
                                    PRELIMINARY TEST REPORT - VIABLE PARTICLES
                                </t>
                            </h1>
                        </div>

                        <!-- Badge especial para Partículas Viables -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #e8f0ff; border: 2px solid #007bff; border-radius: 10px;">
                            <h2 style="color: #007bff; margin: 0;">
                                🔬 
                                <t t-if="language == 'es'">PARTÍCULAS VIABLES</t>
                                <t t-else="">VIABLE PARTICLES</t>
                            </h2>
                            <p style="margin: 5px 0 0 0; font-style: italic;">
                                <t t-if="language == 'es'">Recuento de partículas microbianas en aire</t>
                                <t t-else="">Microbial particle count in air</t>
                            </p>
                        </div>

                        <!-- Información básica (copiada y adaptada) -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses_es" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <t t-set="meses_en" t-value="{
                                '01':'Jan','02':'Feb','03':'Mar','04':'Apr',
                                '05':'May','06':'Jun','07':'Jul','08':'Aug',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dec'
                            }"/>
                            <t t-set="meses" t-value="meses_es if language == 'es' else meses_en"/>
                            
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cadena de Custodia:</t>
                                            <t t-else="">Chain of Custody:</t>
                                        </strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de emisión:</t>
                                            <t t-else="">Issue Date:</t>
                                        </strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cliente:</t>
                                            <t t-else="">Customer:</t>
                                        </strong> 
                                        <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <t t-if="status == 'preliminary'">
                                            <span class="preliminary-badge">
                                                <t t-if="language == 'es'">PRELIMINAR</t>
                                                <t t-else="">PRELIMINARY</t>
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <span class="final-badge">
                                                <t t-if="language == 'es'">FINAL</t>
                                                <t t-else="">FINAL</t>
                                            </span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Muestra:</t>
                                            <t t-else="">Sample:</t>
                                        </strong> 
                                        <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de Recepción:</t>
                                            <t t-else="">Reception Date:</t>
                                        </strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados específicos de Partículas Viables -->
                        <div class="sample-section">
                            <div class="header-title">
                                <t t-if="language == 'es'">Muestra:</t>
                                <t t-else="">Sample:</t>
                                <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Filtrar parámetros relevantes -->
                            <t t-set="particles_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                            
                            <t t-if="particles_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">
                                    <t t-if="language == 'es'">Resultados de Partículas Viables:</t>
                                    <t t-else="">Viable Particles Results:</t>
                                </h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#007bff; color: white;">
                                            <th style="padding:8px; text-align:left; width:30%;">
                                                <t t-if="language == 'es'">Parámetro</t>
                                                <t t-else="">Parameter</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Método</t>
                                                <t t-else="">Method</t>
                                            </th>
                                            <th style="padding:8px; text-align:center; width:20%;">
                                                <t t-if="language == 'es'">Resultado</t>
                                                <t t-else="">Result</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Observaciones</t>
                                                <t t-else="">Observations</t>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="particles_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <strong>
                                                        <span t-esc="parameter.name or parameter.microorganism or 'Sin especificar'"/>
                                                    </strong>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold; color: #007bff;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        <t t-if="language == 'es'">No hay resultados de partículas viables disponibles.</t>
                                        <t t-else="">No viable particles results available.</t>
                                    </p>
                                </div>
                            </t>
                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>
                                    <t t-if="language == 'es'">Método de Ensayo:</t>
                                    <t t-else="">Test Method:</t>
                                </strong> 
                                <t t-if="language == 'es'">
                                    Muestreo activo de aire según normas farmacéuticas aplicables.
                                </t>
                                <t t-else="">
                                    Active air sampling according to applicable pharmaceutical standards.
                                </t>
                            </p>
                            <p style="margin-top: 10px;">
                                <em>
                                    <t t-if="language == 'es'">
                                        Los análisis se realizaron bajo condiciones controladas y validadas.
                                    </t>
                                    <t t-else="">
                                        Analyses were performed under controlled and validated conditions.
                                    </t>
                                </em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE ENDOTOXINAS ========== -->
    <template id="report_endotoxin_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">
                        
                        <!-- Variables de configuración -->
                        <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
                        <t t-set="language" t-value="report_config.get('language', 'es')"/>
                        <t t-set="status" t-value="report_config.get('status', 'final')"/>
                        
                        <!-- Título según idioma y estado -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                <t t-if="language == 'es' and status == 'final'">
                                    INFORME DE ENSAYO - ENDOTOXINAS
                                </t>
                                <t t-elif="language == 'es' and status == 'preliminary'">
                                    INFORME PRELIMINAR - ENDOTOXINAS
                                </t>
                                <t t-elif="language == 'en' and status == 'final'">
                                    TEST REPORT - ENDOTOXIN
                                </t>
                                <t t-elif="language == 'en' and status == 'preliminary'">
                                    PRELIMINARY TEST REPORT - ENDOTOXIN
                                </t>
                            </h1>
                        </div>

                        <!-- Badge especial para Endotoxinas -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #fff8e1; border: 2px solid #ff9800; border-radius: 10px;">
                            <h2 style="color: #ff9800; margin: 0;">
                                🧪 
                                <t t-if="language == 'es'">ENSAYO DE ENDOTOXINAS</t>
                                <t t-else="">ENDOTOXIN ASSAY</t>
                            </h2>
                            <p style="margin: 5px 0 0 0; font-style: italic;">
                                <t t-if="language == 'es'">Detección de endotoxinas bacterianas</t>
                                <t t-else="">Bacterial endotoxin detection</t>
                            </p>
                        </div>

                        <!-- Información básica -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses_es" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <t t-set="meses_en" t-value="{
                                '01':'Jan','02':'Feb','03':'Mar','04':'Apr',
                                '05':'May','06':'Jun','07':'Jul','08':'Aug',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dec'
                            }"/>
                            <t t-set="meses" t-value="meses_es if language == 'es' else meses_en"/>
                            
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cadena de Custodia:</t>
                                            <t t-else="">Chain of Custody:</t>
                                        </strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de emisión:</t>
                                            <t t-else="">Issue Date:</t>
                                        </strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cliente:</t>
                                            <t t-else="">Customer:</t>
                                        </strong> 
                                        <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <t t-if="status == 'preliminary'">
                                            <span class="preliminary-badge">
                                                <t t-if="language == 'es'">PRELIMINAR</t>
                                                <t t-else="">PRELIMINARY</t>
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <span class="final-badge">
                                                <t t-if="language == 'es'">FINAL</t>
                                                <t t-else="">FINAL</t>
                                            </span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Muestra:</t>
                                            <t t-else="">Sample:</t>
                                        </strong> 
                                        <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de Recepción:</t>
                                            <t t-else="">Reception Date:</t>
                                        </strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados específicos de Endotoxinas -->
                        <div class="sample-section">
                            <div class="header-title">
                                <t t-if="language == 'es'">Muestra:</t>
                                <t t-else="">Sample:</t>
                                <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Filtrar parámetros relevantes -->
                            <t t-set="endotoxin_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                            
                            <t t-if="endotoxin_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">
                                    <t t-if="language == 'es'">Resultados de Endotoxinas:</t>
                                    <t t-else="">Endotoxin Results:</t>
                                </h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#ff9800; color: white;">
                                            <th style="padding:8px; text-align:left; width:30%;">
                                                <t t-if="language == 'es'">Parámetro</t>
                                                <t t-else="">Parameter</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Método</t>
                                                <t t-else="">Method</t>
                                            </th>
                                            <th style="padding:8px; text-align:center; width:20%;">
                                                <t t-if="language == 'es'">Resultado</t>
                                                <t t-else="">Result</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Observaciones</t>
                                                <t t-else="">Observations</t>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="endotoxin_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <strong>
                                                        <span t-esc="parameter.name or parameter.microorganism or 'Endotoxinas'"/>
                                                    </strong>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'LAL'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold; color: #ff9800;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        <t t-if="language == 'es'">No hay resultados de endotoxinas disponibles.</t>
                                        <t t-else="">No endotoxin results available.</t>
                                    </p>
                                </div>
                            </t>
                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>
                                    <t t-if="language == 'es'">Método de Ensayo:</t>
                                    <t t-else="">Test Method:</t>
                                </strong> 
                                <t t-if="language == 'es'">
                                    Ensayo LAL (Limulus Amebocyte Lysate) según normas farmacéuticas.
                                </t>
                                <t t-else="">
                                    LAL (Limulus Amebocyte Lysate) assay according to pharmaceutical standards.
                                </t>
                            </p>
                            <p style="margin-top: 10px;">
                                <em>
                                    <t t-if="language == 'es'">
                                        Los análisis se realizaron bajo condiciones de laboratorio controladas.
                                    </t>
                                    <t t-else="">
                                        Analyses were performed under controlled laboratory conditions.
                                    </t>
                                </em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE GENERAL ILAC ========== -->
    <template id="report_general_ilac_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">
                        
                        <!-- Variables de configuración -->
                        <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
                        <t t-set="language" t-value="report_config.get('language', 'es')"/>
                        <t t-set="status" t-value="report_config.get('status', 'final')"/>
                        
                        <!-- Título según idioma y estado -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                <t t-if="language == 'es' and status == 'final'">
                                    INFORME DE ENSAYO
                                </t>
                                <t t-elif="language == 'es' and status == 'preliminary'">
                                    PRELIMINAR - INFORME DE ENSAYO
                                </t>
                                <t t-elif="language == 'en' and status == 'final'">
                                    TEST REPORT FINAL
                                </t>
                                <t t-elif="language == 'en' and status == 'preliminary'">
                                    PRELIMINAR - TEST REPORT
                                </t>
                            </h1>
                        </div>

                        <!-- Badge especial para ILAC -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #f3e5f5; border: 2px solid #9c27b0; border-radius: 10px;">
                            <h2 style="color: #9c27b0; margin: 0;">
                                🏆 
                                <t t-if="language == 'es'">CERTIFICADO CON SELLOS ILAC</t>
                                <t t-else="">CERTIFIED WITH ILAC SEALS</t>
                            </h2>
                            <p style="margin: 5px 0 0 0; font-style: italic;">
                                <t t-if="language == 'es'">Laboratorio acreditado internacionalmente</t>
                                <t t-else="">Internationally accredited laboratory</t>
                            </p>
                        </div>

                        <!-- Información básica -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses_es" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <t t-set="meses_en" t-value="{
                                '01':'Jan','02':'Feb','03':'Mar','04':'Apr',
                                '05':'May','06':'Jun','07':'Jul','08':'Aug',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dec'
                            }"/>
                            <t t-set="meses" t-value="meses_es if language == 'es' else meses_en"/>
                            
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cadena de Custodia:</t>
                                            <t t-else="">Chain of Custody:</t>
                                        </strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de emisión:</t>
                                            <t t-else="">Issue Date:</t>
                                        </strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cliente:</t>
                                            <t t-else="">Customer:</t>
                                        </strong> 
                                        <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <t t-if="status == 'preliminary'">
                                            <span class="preliminary-badge">
                                                <t t-if="language == 'es'">PRELIMINAR</t>
                                                <t t-else="">PRELIMINARY</t>
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <span class="final-badge">
                                                <t t-if="language == 'es'">FINAL</t>
                                                <t t-else="">FINAL</t>
                                            </span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Muestra:</t>
                                            <t t-else="">Sample:</t>
                                        </strong> 
                                        <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de Recepción:</t>
                                            <t t-else="">Reception Date:</t>
                                        </strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados generales -->
                        <div class="sample-section">
                            <div class="header-title">
                                <t t-if="language == 'es'">Muestra:</t>
                                <t t-else="">Sample:</t>
                                <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Todos los parámetros -->
                            <t t-set="all_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                            
                            <t t-if="all_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">
                                    <t t-if="language == 'es'">Resultados de Análisis:</t>
                                    <t t-else="">Analysis Results:</t>
                                </h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#9c27b0; color: white;">
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Parámetro</t>
                                                <t t-else="">Parameter</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Método</t>
                                                <t t-else="">Method</t>
                                            </th>
                                            <th style="padding:8px; text-align:center; width:20%;">
                                                <t t-if="language == 'es'">Resultado</t>
                                                <t t-else="">Result</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:30%;">
                                                <t t-if="language == 'es'">Observaciones</t>
                                                <t t-else="">Observations</t>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="all_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <t t-if="parameter.microorganism">
                                                        <strong><span t-esc="parameter.microorganism"/></strong>
                                                    </t>
                                                    <t t-else="">
                                                        <strong><span t-esc="parameter.name or 'Sin nombre'"/></strong>
                                                    </t>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold; color: #9c27b0;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        <t t-if="language == 'es'">No hay resultados disponibles.</t>
                                        <t t-else="">No results available.</t>
                                    </p>
                                </div>
                            </t>
                        </div>

                        <!-- Sección ILAC -->
                        <div style="margin-top: 30px; padding: 15px; background-color: #f3e5f5; border: 2px solid #9c27b0; border-radius: 10px;">
                            <h4 style="color: #9c27b0; margin: 0 0 10px 0; text-align: center;">
                                🏆 
                                <t t-if="language == 'es'">ACREDITACIÓN ILAC</t>
                                <t t-else="">ILAC ACCREDITATION</t>
                            </h4>
                            <p style="margin: 0; font-size: 11px; text-align: center;">
                                <t t-if="language == 'es'">
                                    Este laboratorio está acreditado bajo normas internacionales ILAC.
                                    Los resultados están respaldados por nuestro sistema de calidad certificado.
                                </t>
                                <t t-else="">
                                    This laboratory is accredited under international ILAC standards.
                                    Results are backed by our certified quality system.
                                </t>
                            </p>
                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>
                                    <t t-if="language == 'es'">Tipo de Reporte:</t>
                                    <t t-else="">Report Type:</t>
                                </strong> 
                                <t t-if="language == 'es'">
                                    Informe general de ensayos con certificación ILAC.
                                </t>
                                <t t-else="">
                                    General test report with ILAC certification.
                                </t>
                            </p>
                            <p style="margin-top: 10px;">
                                <em>
                                    <t t-if="language == 'es'">
                                        Los análisis se realizaron conforme a normas internacionales bajo acreditación ILAC.
                                    </t>
                                    <t t-else="">
                                        Analyses were performed according to international standards under ILAC accreditation.
                                    </t>
                                </em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- ========== TEMPLATE GENERAL SIN ILAC ========== -->
    <template id="report_general_no_ilac_template">
        <t t-call="lims_analysis_v2.report_analysis_base_template">
            <t t-foreach="docs" t-as="analysis">
                <div class="page">
                    <div class="main-content">
                        
                        <!-- Variables de configuración -->
                        <t t-set="report_config" t-value="context.get('custom_report_config', {})"/>
                        <t t-set="language" t-value="report_config.get('language', 'es')"/>
                        <t t-set="status" t-value="report_config.get('status', 'final')"/>
                        
                        <!-- Título según idioma y estado -->
                        <div style="text-align: center; margin: 20px 0 30px 0;">
                            <h1 style="font-size: 24px; font-weight: bold; margin: 0;">
                                <t t-if="language == 'es' and status == 'final'">
                                    INFORME DE ENSAYO
                                </t>
                                <t t-elif="language == 'es' and status == 'preliminary'">
                                    PRELIMINAR - INFORME DE ENSAYO
                                </t>
                                <t t-elif="language == 'en' and status == 'final'">
                                    TEST REPORT
                                </t>
                                <t t-elif="language == 'en' and status == 'preliminary'">
                                    PRELIMINAR - TEST REPORT
                                </t>
                            </h1>
                        </div>

                        <!-- Badge general (sin ILAC) -->
                        <div style="text-align: center; margin: 20px 0; padding: 15px; background-color: #e8f5e8; border: 2px solid #4caf50; border-radius: 10px;">
                            <h2 style="color: #4caf50; margin: 0;">
                                📄 
                                <t t-if="language == 'es'">INFORME GENERAL DE LABORATORIO</t>
                                <t t-else="">GENERAL LABORATORY REPORT</t>
                            </h2>
                            <p style="margin: 5px 0 0 0; font-style: italic;">
                                <t t-if="language == 'es'">Análisis realizados según procedimientos estándar</t>
                                <t t-else="">Analyses performed according to standard procedures</t>
                            </p>
                        </div>

                        <!-- Información básica -->
                        <table class="table table-borderless mt-1" style="width:100%; font-size:14px; border-collapse:collapse;">
                            <t t-set="meses_es" t-value="{
                                '01':'Ene','02':'Feb','03':'Mar','04':'Abr',
                                '05':'May','06':'Jun','07':'Jul','08':'Ago',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dic'
                            }"/>
                            <t t-set="meses_en" t-value="{
                                '01':'Jan','02':'Feb','03':'Mar','04':'Apr',
                                '05':'May','06':'Jun','07':'Jul','08':'Aug',
                                '09':'Sep','10':'Oct','11':'Nov','12':'Dec'
                            }"/>
                            <t t-set="meses" t-value="meses_es if language == 'es' else meses_en"/>
                            
                            <tbody>
                                <tr>
                                    <td style="width:50%; padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cadena de Custodia:</t>
                                            <t t-else="">Chain of Custody:</t>
                                        </strong> 
                                        <span t-esc="analysis.custody_chain_code"/>
                                    </td>
                                    <td style="width:50%; padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de emisión:</t>
                                            <t t-else="">Issue Date:</t>
                                        </strong>
                                        <t t-set="today" t-value="datetime.datetime.now()"/>
                                        <t t-set="d_today" t-value="today.strftime('%d')"/>
                                        <t t-set="m_today" t-value="today.strftime('%m')"/>
                                        <t t-set="y_today" t-value="today.strftime('%Y')"/>
                                        <span t-esc="d_today + '/' + meses[m_today] + '/' + y_today"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Cliente:</t>
                                            <t t-else="">Customer:</t>
                                        </strong> 
                                        <span t-esc="analysis.customer_id.name"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <t t-if="status == 'preliminary'">
                                            <span class="preliminary-badge">
                                                <t t-if="language == 'es'">PRELIMINAR</t>
                                                <t t-else="">PRELIMINARY</t>
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <span class="final-badge">
                                                <t t-if="language == 'es'">FINAL</t>
                                                <t t-else="">FINAL</t>
                                            </span>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding:4px;">
                                        <strong>
                                            <t t-if="language == 'es'">Muestra:</t>
                                            <t t-else="">Sample:</t>
                                        </strong> 
                                        <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                                    </td>
                                    <td style="padding:4px; text-align:right;">
                                        <strong>
                                            <t t-if="language == 'es'">Fecha de Recepción:</t>
                                            <t t-else="">Reception Date:</t>
                                        </strong>
                                        <t t-if="analysis.reception_date">
                                            <t t-set="r_date" t-value="analysis.reception_date"/>
                                            <t t-set="d_reception" t-value="r_date.strftime('%d')"/>
                                            <t t-set="m_reception" t-value="r_date.strftime('%m')"/>
                                            <t t-set="y_reception" t-value="r_date.strftime('%Y')"/>
                                            <span t-esc="d_reception + '/' + meses[m_reception] + '/' + y_reception"/>
                                        </t>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Separador -->
                        <hr style="margin: 20px 0; border: 1px solid;"/>

                        <!-- Resultados generales -->
                        <div class="sample-section">
                            <div class="header-title">
                                <t t-if="language == 'es'">Muestra:</t>
                                <t t-else="">Sample:</t>
                                <span t-esc="analysis.sample_code"/> - <span t-esc="analysis.sample_identifier"/>
                            </div>

                            <!-- Todos los parámetros -->
                            <t t-set="all_params" t-value="analysis.parameter_analysis_ids.filtered(lambda p: (p.report_status == 'ready' if status == 'preliminary' else p.report_status in ['ready', 'reported']))"/>
                            
                            <t t-if="all_params">
                                <h5 style="font-size: 14px; margin: 15px 0 5px 0;">
                                    <t t-if="language == 'es'">Resultados de Análisis:</t>
                                    <t t-else="">Analysis Results:</t>
                                </h5>
                                <table class="table table-bordered" style="width:100%; font-size:11px; border-collapse:collapse;">
                                    <thead>
                                        <tr style="background-color:#4caf50; color: white;">
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Parámetro</t>
                                                <t t-else="">Parameter</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:25%;">
                                                <t t-if="language == 'es'">Método</t>
                                                <t t-else="">Method</t>
                                            </th>
                                            <th style="padding:8px; text-align:center; width:20%;">
                                                <t t-if="language == 'es'">Resultado</t>
                                                <t t-else="">Result</t>
                                            </th>
                                            <th style="padding:8px; text-align:left; width:30%;">
                                                <t t-if="language == 'es'">Observaciones</t>
                                                <t t-else="">Observations</t>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="all_params" t-as="parameter">
                                            <tr class="result-row">
                                                <td style="padding:8px;">
                                                    <t t-if="parameter.microorganism">
                                                        <strong><span t-esc="parameter.microorganism"/></strong>
                                                    </t>
                                                    <t t-else="">
                                                        <strong><span t-esc="parameter.name or 'Sin nombre'"/></strong>
                                                    </t>
                                                </td>
                                                <td style="padding:8px;">
                                                    <span t-esc="parameter.method or 'No especificado'"/>
                                                </td>
                                                <td style="padding:8px; text-align:center; font-weight:bold; color: #4caf50;">
                                                    <span t-esc="parameter.result_complete or parameter.result_value or 'Sin resultado'"/>
                                                </td>
                                                <td style="padding:8px; font-size:10px;">
                                                    <span t-esc="parameter.analyst_notes or '—'"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <div style="text-align: center; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px;">
                                    <p style="margin: 0; font-style: italic; color: #856404;">
                                        <t t-if="language == 'es'">No hay resultados disponibles.</t>
                                        <t t-else="">No results available.</t>
                                    </p>
                                </div>
                            </t>
                        </div>

                        <!-- Información adicional -->
                        <div style="margin-top: 30px; font-size: 11px; color: #666;">
                            <p>
                                <strong>
                                    <t t-if="language == 'es'">Tipo de Reporte:</t>
                                    <t t-else="">Report Type:</t>
                                </strong> 
                                <t t-if="language == 'es'">
                                    Informe general de ensayos de laboratorio.
                                </t>
                                <t t-else="">
                                    General laboratory test report.
                                </t>
                            </p>
                            <p style="margin-top: 10px;">
                                <em>
                                    <t t-if="language == 'es'">
                                        Los análisis se realizaron según procedimientos establecidos en el laboratorio.
                                    </t>
                                    <t t-else="">
                                        Analyses were performed according to established laboratory procedures.
                                    </t>
                                </em>
                            </p>
                        </div>

                    </div>
                </div>
            </t>
        </t>
    </template>

</odoo>