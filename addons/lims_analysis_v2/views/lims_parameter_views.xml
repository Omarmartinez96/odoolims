<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- ========== VISTA FORMULARIO DE PAR√ÅMETRO DE AN√ÅLISIS ========== -->
        <record id="view_parameter_analysis_v2_form" model="ir.ui.view">
            <field name="name">lims.parameter.analysis.v2.form</field>
            <field name="model">lims.parameter.analysis.v2</field>
            <field name="arch" type="xml">
                <form string="Par√°metro de An√°lisis v2">
                    
                    <sheet>
                        <!-- T√≠tulo -->
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                            <h3>
                                <field name="microorganism" readonly="1" placeholder="Sin microorganismo especificado"/>
                            </h3>
                        </div>

                        <!-- Informaci√≥n b√°sica -->
                        <group>
                            <group string="üìã Informaci√≥n del Par√°metro">
                                <field name="method" readonly="1"/>
                                <field name="category" readonly="1"/>
                                <field name="unit" readonly="1"/>
                                <field name="result_type" widget="radio" required="1"/>
                            </group>
                            <group string="üìÖ Informaci√≥n del An√°lisis">
                                <field name="analysis_start_date"/>
                                <field name="analysis_commitment_date"/>
                                <field name="analyst_names" placeholder="Iniciales separadas por comas"/>
                                <field name="analysis_status" 
                                       decoration-success="analysis_status == 'completed'"
                                       decoration-info="analysis_status == 'in_progress'"
                                       decoration-muted="analysis_status == 'draft'"/>
                                <field name="report_status" readonly="1"
                                       decoration-success="report_status == 'ready'"
                                       decoration-info="report_status == 'reported'"
                                       decoration-muted="report_status == 'draft'"/>
                            </group>
                        </group>

                        <!-- Configuraci√≥n autom√°tica de procesos seg√∫n categor√≠a y tipo -->
                        <group string="üîß Configuraci√≥n de Procesos" invisible="category != 'microbiological'">
                            <div class="alert alert-info" style="margin-bottom: 10px;" colspan="4">
                                <strong>‚ÑπÔ∏è Configuraci√≥n Autom√°tica:</strong> 
                                Selecciona los procesos que requiere este par√°metro para mostrar las pesta√±as correspondientes.
                            </div>
                            <field name="requires_pre_enrichment" invisible="result_type != 'qualitative'"/>
                            <field name="requires_selective_enrichment" invisible="result_type != 'qualitative'"/>
                            <field name="requires_confirmation"/>
                            <field name="requires_ph_adjustment"/>
                        </group>

                        <notebook>
                            
                            <!-- TAB DE CONFIGURACI√ìN DE PROCESOS (como est√° actualmente) -->
                            <page string="üîß Configuraci√≥n de Procesos" invisible="category != 'microbiological'">
                                <div class="alert alert-info" style="margin-bottom: 10px;" colspan="4">
                                    <strong>‚ÑπÔ∏è Configuraci√≥n:</strong> 
                                    Selecciona los procesos requeridos para mostrar las pesta√±as correspondientes.
                                </div>
                                <field name="requires_pre_enrichment" invisible="result_type != 'qualitative'"/>
                                <field name="requires_selective_enrichment" invisible="result_type != 'qualitative'"/>
                                <field name="requires_confirmation"/>
                                <field name="requires_ph_adjustment"/>
                            </page>

                            <!-- TAB DE PRE-ENRIQUECIMIENTO -->
                            <page string="üî¨ Pre-enriquecimiento" invisible="requires_pre_enrichment == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="pre_enrichment_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                    invisible="pre_enrichment_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="pre_enrichment_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="pre_enrichment_processing_date"/>
                                    <field name="pre_enrichment_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios y Reactivos de Pre-enriquecimiento">
                                    <field name="media_ids" nolabel="1" colspan="2" 
                                        domain="[('process_type', '=', 'pre_enrichment')]"
                                        context="{'default_process_type': 'pre_enrichment', 'default_media_usage': 'enriquecimiento'}">
                                        
                                        <list string="Medios de Pre-enriquecimiento" editable="bottom">
                                            <field name="process_type" invisible="1"/>
                                            <field name="media_source" string="Origen"/>
                                            <field name="culture_media_name" string="Medio"/>
                                            <field name="culture_media_batch_id" invisible="media_source != 'internal'"/>
                                            <field name="external_batch_code" invisible="media_source != 'external'"/>
                                            <field name="media_usage" string="Uso"/>
                                            <field name="requires_incubation" string="Incubaci√≥n?"/>
                                            <field name="incubation_status" invisible="requires_incubation == False"/>
                                            <field name="qualitative_result" string="Resultado"/>
                                        </list>
                                        
                                        <!-- Aqu√≠ va el form view igual que tienes actualmente -->
                                        
                                    </field>
                                </group>
                            </page>

                            <!-- TAB DE ENRIQUECIMIENTO SELECTIVO -->
                            <page string="üß´ Enriquecimiento Selectivo" invisible="requires_selective_enrichment == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="selective_enrichment_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                    invisible="selective_enrichment_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="selective_enrichment_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="selective_enrichment_processing_date"/>
                                    <field name="selective_enrichment_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios Selectivos">
                                    <field name="media_ids" nolabel="1" colspan="2" 
                                        domain="[('process_type', '=', 'selective_enrichment')]"
                                        context="{'default_process_type': 'selective_enrichment', 'default_media_usage': 'desarrollo_selectivo'}">
                                        
                                        <list string="Medios Selectivos" editable="bottom">
                                            <field name="process_type" invisible="1"/>
                                            <field name="media_source" string="Origen"/>
                                            <field name="culture_media_name" string="Medio"/>
                                            <field name="culture_media_batch_id" invisible="media_source != 'internal'"/>
                                            <field name="external_batch_code" invisible="media_source != 'external'"/>
                                            <field name="media_usage" string="Uso"/>
                                            <field name="requires_incubation" string="Incubaci√≥n?"/>
                                            <field name="incubation_status" invisible="requires_incubation == False"/>
                                            <field name="qualitative_result" string="Resultado"/>
                                        </list>
                                        
                                    </field>
                                </group>
                            </page>

                            <!-- TAB DE AN√ÅLISIS CUANTITATIVO -->
                            <page string="üî¢ An√°lisis Cuantitativo" invisible="result_type != 'quantitative'">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="quantitative_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                    invisible="quantitative_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="quantitative_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="quantitative_processing_date"/>
                                    <field name="quantitative_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios para An√°lisis Cuantitativo">
                                    <field name="media_ids" nolabel="1" colspan="2" 
                                        domain="[('process_type', '=', 'quantitative')]"
                                        context="{'default_process_type': 'quantitative', 'default_media_usage': 'diluyente'}">
                                        
                                        <list string="Medios Cuantitativos" editable="bottom">
                                            <field name="process_type" invisible="1"/>
                                            <field name="media_source" string="Origen"/>
                                            <field name="culture_media_name" string="Medio"/>
                                            <field name="culture_media_batch_id" invisible="media_source != 'internal'"/>
                                            <field name="external_batch_code" invisible="media_source != 'external'"/>
                                            <field name="media_usage" string="Uso"/>
                                            <field name="requires_incubation" string="Incubaci√≥n?"/>
                                            <field name="incubation_status" invisible="requires_incubation == False"/>
                                            <field name="qualitative_result" string="Resultado"/>
                                        </list>
                                        
                                    </field>
                                </group>
                            </page>

                            <!-- TAB DE AN√ÅLISIS CUALITATIVO -->
                            <page string="üß™ An√°lisis Cualitativo" invisible="result_type != 'qualitative'">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="qualitative_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                    invisible="qualitative_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="qualitative_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="qualitative_processing_date"/>
                                    <field name="qualitative_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios para An√°lisis Cualitativo">
                                    <field name="media_ids" nolabel="1" colspan="2" 
                                        domain="[('process_type', '=', 'qualitative')]"
                                        context="{'default_process_type': 'qualitative', 'default_media_usage': 'desarrollo_selectivo'}">
                                        
                                        <list string="Medios Cualitativos" editable="bottom">
                                            <field name="process_type" invisible="1"/>
                                            <field name="media_source" string="Origen"/>
                                            <field name="culture_media_name" string="Medio"/>
                                            <field name="culture_media_batch_id" invisible="media_source != 'internal'"/>
                                            <field name="external_batch_code" invisible="media_source != 'external'"/>
                                            <field name="media_usage" string="Uso"/>
                                            <field name="requires_incubation" string="Incubaci√≥n?"/>
                                            <field name="incubation_status" invisible="requires_incubation == False"/>
                                            <field name="qualitative_result" string="Resultado"/>
                                        </list>
                                        
                                    </field>
                                </group>
                            </page>

                            <!-- TAB DE CONFIRMACI√ìN -->
                            <page string="‚úÖ Confirmaci√≥n" invisible="requires_confirmation == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="confirmation_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                    invisible="confirmation_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="confirmation_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="confirmation_processing_date"/>
                                    <field name="confirmation_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios de Confirmaci√≥n">
                                    <field name="media_ids" nolabel="1" colspan="2" 
                                        domain="[('process_type', '=', 'confirmation')]"
                                        context="{'default_process_type': 'confirmation', 'default_media_usage': 'pruebas_bioquimicas'}">
                                        
                                        <list string="Medios de Confirmaci√≥n" editable="bottom">
                                            <field name="process_type" invisible="1"/>
                                            <field name="media_source" string="Origen"/>
                                            <field name="culture_media_name" string="Medio"/>
                                            <field name="culture_media_batch_id" invisible="media_source != 'internal'"/>
                                            <field name="external_batch_code" invisible="media_source != 'external'"/>
                                            <field name="media_usage" string="Uso"/>
                                            <field name="requires_incubation" string="Incubaci√≥n?"/>
                                            <field name="incubation_status" invisible="requires_incubation == False"/>
                                            <field name="qualitative_result" string="Resultado"/>
                                        </list>
                                        
                                    </field>
                                </group>
                            </page>

                            <!-- TAB DE DATOS CRUDOS (mantener como est√°) -->
                            <page string="üî¢ Datos Crudos de Diluciones" 
                                invisible="category != 'microbiological' or result_type != 'quantitative'">
                                <!-- Mantener contenido actual -->
                            </page>

                            <!-- TAB DE CONTROL DE CALIDAD (mantener como est√°) -->
                            <page string="üî¨ Control de Calidad">
                                <!-- Mantener contenido actual -->
                            </page>

                            <!-- TAB DE RESULTADO FINAL (mantener como est√°) -->
                            <page string="üìä Resultado Final">
                                <!-- Mantener contenido actual -->
                            </page>

                            <!-- TAB DE RESULTADOS DE CONFIRMACI√ìN (mantener como est√°) -->
                            <page string="‚úÖ Resultados de Confirmaci√≥n" invisible="requires_confirmation == False">
                                <!-- Mantener contenido actual -->
                            </page>

                        </notebook>

                    </sheet>
                </form>
            </field>
        </record>

        <!-- ========== VISTA LISTA DE PAR√ÅMETROS ========== -->
        <record id="view_parameter_analysis_v2_list" model="ir.ui.view">
            <field name="name">lims.parameter.analysis.v2.list</field>
            <field name="model">lims.parameter.analysis.v2</field>
            <field name="arch" type="xml">
                <list string="Par√°metros de An√°lisis v2">
                    <field name="analysis_id"/>
                    <field name="name"/>
                    <field name="microorganism"/>
                    <field name="method"/>
                    <field name="result_type"/>
                    <field name="analysis_status" 
                           decoration-success="analysis_status == 'completed'"
                           decoration-info="analysis_status == 'in_progress'"
                           decoration-muted="analysis_status == 'draft'"/>
                    <field name="report_status" 
                           decoration-success="report_status == 'ready'"
                           decoration-info="report_status == 'reported'"
                           decoration-muted="report_status == 'draft'"/>
                    <field name="result_complete" class="o_field_highlight"/>
                    <field name="analyst_names"/>
                    <field name="analysis_start_date"/>
                </list>
            </field>
        </record>

        <!-- ========== ACCI√ìN PARA PAR√ÅMETROS ========== -->
        <record id="action_parameter_analysis_v2" model="ir.actions.act_window">
            <field name="name">Par√°metros de An√°lisis v2</field>
            <field name="res_model">lims.parameter.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay par√°metros de an√°lisis
                </p>
                <p>
                    Los par√°metros se crean autom√°ticamente al crear an√°lisis
                </p>
            </field>
        </record>

    </data>
</odoo>