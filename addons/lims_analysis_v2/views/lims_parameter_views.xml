<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        
        <!-- ========== VISTA FORMULARIO COMPLETA DE PAR√ÅMETRO DE AN√ÅLISIS ========== -->
        <record id="view_parameter_analysis_v2_form" model="ir.ui.view">
            <field name="name">lims.parameter.analysis.v2.form</field>
            <field name="model">lims.parameter.analysis.v2</field>
            <field name="arch" type="xml">
                <form string="Par√°metro de An√°lisis v2">
                    
                    <sheet>
                        <!-- T√≠tulo -->
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                            <h3>
                                <field name="microorganism" readonly="1" placeholder="Sin microorganismo especificado"/>
                            </h3>
                        </div>

                        <!-- Informaci√≥n b√°sica -->
                        <group>
                            <group string="üìã Informaci√≥n del Par√°metro">
                                <field name="method" readonly="1"/>
                                <field name="category" readonly="1"/>
                                <field name="unit" readonly="1"/>
                                <field name="result_type" widget="radio" required="1"/>
                            </group>
                            <group string="üìÖ Informaci√≥n del An√°lisis">
                                <field name="analysis_start_date"/>
                                <field name="analysis_commitment_date"/>
                                <field name="analyst_names" placeholder="Iniciales separadas por comas"/>
                                <field name="analysis_status_checkbox" widget="radio"/>
                                <field name="report_status" readonly="1"
                                       decoration-success="report_status == 'ready'"
                                       decoration-info="report_status == 'reported'"
                                       decoration-muted="report_status == 'draft'"/>
                            </group>
                        </group>

                        <!-- Configuraci√≥n de procesos seg√∫n categor√≠a y tipo -->
                        <group string="üîß Configuraci√≥n de Procesos" invisible="category != 'microbiological'">
                            <div class="alert alert-info" style="margin-bottom: 10px;" colspan="4">
                                <strong>‚ÑπÔ∏è Configuraci√≥n:</strong> 
                                Selecciona los procesos que requiere este par√°metro para mostrar las pesta√±as correspondientes.
                            </div>
                            
                            <!-- Para An√°lisis Cualitativos -->
                            <group string="Procesos para An√°lisis Cualitativos" invisible="result_type != 'qualitative'" colspan="2">
                                <field name="requires_pre_enrichment"/>
                                <field name="requires_selective_enrichment"/>
                            </group>
                            
                            <!-- Para Todos los Tipos -->
                            <group string="Procesos Adicionales" colspan="2">
                                <field name="requires_confirmation"/>
                                <field name="requires_ph_adjustment"/>
                            </group>
                        </group>

                        <!-- Notebook principal con pesta√±as espec√≠ficas por proceso -->
                        <notebook>
                            
                            <!-- ========== TAB DE PRE-ENRIQUECIMIENTO ========== -->
                            <page string="üî¨ Pre-enriquecimiento" invisible="requires_pre_enrichment == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="pre_enrichment_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                       invisible="pre_enrichment_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="pre_enrichment_equipment_id" 
                                           placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="pre_enrichment_processing_date"/>
                                    <field name="pre_enrichment_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios y Reactivos">
                                    <field name="pre_enrichment_media_ids" nolabel="1" colspan="2"
                                           context="{'default_process_type': 'pre_enrichment', 'default_media_usage': 'enriquecimiento'}">

                                        <list string="Medios de Pre-enriquecimiento" create="true" delete="true" edit="true">
                                            <field name="media_source" string="Origen" width="15%"/>
                                            <field name="culture_media_name" string="Nombre del Medio" width="25%"/>
                                            <field name="culture_media_batch_id" 
                                                string="Lote Interno"
                                                invisible="media_source != 'internal'"
                                                width="20%"/>
                                            <field name="external_batch_code" 
                                                string="Lote Externo" 
                                                invisible="media_source != 'external'"
                                                width="20%"/>
                                            <field name="media_usage" string="Uso" width="20%"/>
                                            <field name="requires_incubation" string="¬øIncubaci√≥n?"/>
                                            <field name="incubation_equipment" 
                                                invisible="requires_incubation == False"
                                                placeholder="Equipo de incubaci√≥n"/>
                                            <field name="incubation_start_date" 
                                                invisible="requires_incubation == False"
                                                placeholder="Fecha inicio"/>
                                            <field name="incubation_start_time" 
                                                invisible="requires_incubation == False"
                                                placeholder="HH:MM"/>
                                            <field name="incubation_end_date" 
                                                invisible="requires_incubation == False"
                                                placeholder="Fecha fin"/>
                                            <field name="incubation_end_time" 
                                                invisible="requires_incubation == False"
                                                placeholder="HH:MM"/>
                                            <field name="incubation_status" 
                                                invisible="requires_incubation == False"
                                                decoration-success="incubation_status == 'completed'"
                                                decoration-warning="incubation_status == 'overdue'"
                                                decoration-info="incubation_status == 'active'"/>
                                            <field name="qualitative_result" string="Resultado" optional="show"/>
                                        </list>
                                        
                                        <form string="Medio/Reactivo de Pre-enriquecimiento">
                                            <group>
                                                <group>
                                                    <field name="process_type" invisible="1"/>
                                                    <field name="media_source" widget="radio"/>
                                                    <field name="culture_media_name" 
                                                        placeholder="Nombre del medio de cultivo"
                                                        required="1"/>
                                                </group>

                                                <group string="Lote del Medio">
                                                    <field name="culture_media_batch_id" 
                                                        invisible="media_source != 'internal'"
                                                        placeholder="Seleccionar lote interno"
                                                        options="{'no_create': True}"/>
                                                    <field name="external_batch_code" 
                                                        invisible="media_source != 'external'"
                                                        placeholder="C√≥digo del lote externo"
                                                        required="media_source == 'external'"/>
                                                </group>

                                                <group>
                                                    <field name="media_usage" 
                                                        string="Uso del Medio"
                                                        required="1"/>
                                                    <field name="requires_incubation" string="¬øRequiere Incubaci√≥n?"/>
                                                </group>
                                            </group>
                                            
                                            <!-- Incubaci√≥n cuando se requiere -->
                                            <group string="üå°Ô∏è Incubaci√≥n" 
                                                   invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_equipment" 
                                                           placeholder="Equipo utilizado"/>
                                                    <field name="incubation_start_date"/>
                                                    <field name="incubation_start_time" placeholder="HH:MM"/>
                                                </group>
                                                <group>
                                                    <field name="incubation_end_date"/>
                                                    <field name="incubation_end_time" placeholder="HH:MM"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üìä Estado de Incubaci√≥n" 
                                                invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_status" readonly="1"/>
                                                    <field name="time_remaining" readonly="1" 
                                                        invisible="incubation_status != 'active'"/>
                                                    <field name="is_overdue" readonly="1" widget="boolean_toggle"/>
                                                </group>

                                                <group>
                                                    <field name="incubation_end_date_real"/>
                                                    <field name="incubation_end_time_real" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                            <group string="üß™ Resultado en este Medio (Si Aplica)">
                                                <field name="qualitative_result"/>
                                            </group>

                                            <group string="üìù Notas de Preparaci√≥n">
                                                <field name="preparation_notes" nolabel="1"
                                                       placeholder="Instrucciones especiales, observaciones, etc..."/>
                                            </group>
                                        </form>
                                    </field>
                                </group>
                                
                            </page>

                            <!-- ========== TAB DE ENRIQUECIMIENTO SELECTIVO ========== -->
                            <page string="üß´ Enriquecimiento Selectivo" invisible="requires_selective_enrichment == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="selective_enrichment_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                       invisible="selective_enrichment_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="selective_enrichment_equipment_id" 
                                           placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="selective_enrichment_processing_date"/>
                                    <field name="selective_enrichment_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios Selectivos y Reactivos">
                                    <field name="selective_enrichment_media_ids" nolabel="1" colspan="2"
                                           context="{'default_process_type': 'selective_enrichment', 'default_media_usage': 'desarrollo_selectivo'}">

                                        <list string="Medios Selectivos Utilizados" create="true" delete="true" edit="true">
                                            <field name="media_source" string="Origen" width="15%"/>
                                            <field name="culture_media_name" string="Nombre del Medio" width="25%"/>
                                            <field name="culture_media_batch_id" 
                                                string="Lote Interno"
                                                invisible="media_source != 'internal'"
                                                width="20%"/>
                                            <field name="external_batch_code" 
                                                string="Lote Externo" 
                                                invisible="media_source != 'external'"
                                                width="20%"/>
                                            <field name="media_usage" string="Uso" width="20%"/>
                                            <field name="requires_incubation" string="¬øIncubaci√≥n?"/>
                                            <field name="incubation_status" 
                                                invisible="requires_incubation == False"
                                                decoration-success="incubation_status == 'completed'"
                                                decoration-warning="incubation_status == 'overdue'"
                                                decoration-info="incubation_status == 'active'"/>
                                            <field name="qualitative_result" string="Resultado" optional="show"/>
                                        </list>
                                        
                                        <form string="Medio Selectivo Utilizado">
                                            <!-- Mismo form structure que pre-enrichment -->
                                            <group>
                                                <group>
                                                    <field name="process_type" invisible="1"/>
                                                    <field name="media_source" widget="radio"/>
                                                    <field name="culture_media_name" 
                                                        placeholder="Nombre del medio de cultivo"
                                                        required="1"/>
                                                </group>

                                                <group string="Lote del Medio">
                                                    <field name="culture_media_batch_id" 
                                                        invisible="media_source != 'internal'"
                                                        placeholder="Seleccionar lote interno"
                                                        options="{'no_create': True}"/>
                                                    <field name="external_batch_code" 
                                                        invisible="media_source != 'external'"
                                                        placeholder="C√≥digo del lote externo"
                                                        required="media_source == 'external'"/>
                                                </group>

                                                <group>
                                                    <field name="media_usage" 
                                                        string="Uso del Medio"
                                                        required="1"/>
                                                    <field name="requires_incubation" string="¬øRequiere Incubaci√≥n?"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üå°Ô∏è Incubaci√≥n" 
                                                   invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_equipment" 
                                                           placeholder="Equipo utilizado"/>
                                                    <field name="incubation_start_date"/>
                                                    <field name="incubation_start_time" placeholder="HH:MM"/>
                                                </group>
                                                <group>
                                                    <field name="incubation_end_date"/>
                                                    <field name="incubation_end_time" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                            <group string="üìä Estado de Incubaci√≥n" 
                                                invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_status" readonly="1"/>
                                                    <field name="time_remaining" readonly="1" 
                                                        invisible="incubation_status != 'active'"/>
                                                    <field name="is_overdue" readonly="1" widget="boolean_toggle"/>
                                                </group>

                                                <group>
                                                    <field name="incubation_end_date_real"/>
                                                    <field name="incubation_end_time_real" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                            <group string="üß™ Resultado en este Medio (Si Aplica)">
                                                <field name="qualitative_result"/>
                                            </group>

                                            <group string="üìù Notas de Preparaci√≥n">
                                                <field name="preparation_notes" nolabel="1"
                                                       placeholder="Instrucciones especiales, observaciones, etc..."/>
                                            </group>
                                        </form>
                                    </field>
                                </group>
                                
                            </page>

                            <!-- ========== TAB DE AN√ÅLISIS CUANTITATIVO ========== -->
                            <page string="üî¢ An√°lisis Cuantitativo" invisible="result_type != 'quantitative'">
                        
                                <group string="üè≠ Ambiente de Procesamiento Cuantitativo">
                                    <field name="quantitative_environment" widget="radio"/>
                                </group>

                                <group string="üîß Equipo Utilizado para Cuantitativo" 
                                    invisible="quantitative_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="quantitative_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>

                                <group string="üìÖ Fechas del Proceso Cuantitativo">
                                    <field name="quantitative_processing_date"/>
                                    <field name="quantitative_processing_time" placeholder="HH:MM"/>
                                </group>

                                <group string="üß™ Medios Utilizados en el An√°lisis">
                                    <field name="quantitative_media_ids" nolabel="1" colspan="2"
                                           context="{'default_process_type': 'quantitative', 'default_media_usage': 'diluyente'}">

                                        <list string="Medios para An√°lisis Cuantitativo" create="true" delete="true" edit="true">
                                            <field name="culture_media_name" string="Nombre del Medio" width="25%"/>
                                            <field name="culture_media_batch_id" 
                                                string="Lote Interno"
                                                invisible="media_source != 'internal'"
                                                width="25%"/>
                                            <field name="media_usage" string="Uso" width="25%"/>
                                            <field name="incubation_status" width="25%" 
                                                invisible="requires_incubation == False"
                                                decoration-success="incubation_status == 'completed'"
                                                decoration-warning="incubation_status == 'overdue'"
                                                decoration-info="incubation_status == 'active'"/>
                                        </list>
                                        
                                        <form string="Medio Utilizado para Cuantitativo">
                                            <!-- Mismo form structure -->
                                            <group>
                                                <group>
                                                    <field name="process_type" invisible="1"/>
                                                    <field name="media_source" widget="radio"/>
                                                    <field name="culture_media_name" 
                                                        placeholder="Nombre del medio de cultivo"
                                                        required="1"/>
                                                </group>

                                                <group string="Lote del Medio">
                                                    <field name="culture_media_batch_id" 
                                                        invisible="media_source != 'internal'"
                                                        placeholder="Seleccionar lote interno"
                                                        options="{'no_create': True}"/>
                                                    <field name="external_batch_code" 
                                                        invisible="media_source != 'external'"
                                                        placeholder="C√≥digo del lote externo"
                                                        required="media_source == 'external'"/>
                                                </group>

                                                <group>
                                                    <field name="media_usage" 
                                                        string="Uso del Medio"
                                                        required="1"/>
                                                    <field name="requires_incubation" string="¬øRequiere Incubaci√≥n?"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üå°Ô∏è Incubaci√≥n" 
                                                   invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_equipment" 
                                                           placeholder="Equipo utilizado"/>
                                                    <field name="incubation_start_date"/>
                                                    <field name="incubation_start_time" placeholder="HH:MM"/>
                                                </group>
                                                <group>
                                                    <field name="incubation_end_date"/>
                                                    <field name="incubation_end_time" placeholder="HH:MM"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üìä Estado de Incubaci√≥n" 
                                                invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_status" readonly="1"/>
                                                    <field name="time_remaining" readonly="1" 
                                                        invisible="incubation_status != 'active'"/>
                                                    <field name="is_overdue" readonly="1" widget="boolean_toggle"/>
                                                </group>

                                                <group>
                                                    <field name="incubation_end_date_real"/>
                                                    <field name="incubation_end_time_real" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                        </form>
                                    </field>
                                </group>

                            </page>

                            <!-- ========== TAB DE AN√ÅLISIS CUALITATIVO ========== -->
                            <page string="üß™ An√°lisis Cualitativo" invisible="result_type != 'qualitative'">
                        
                                <group string="üè≠ Ambiente de Procesamiento Cualitativo">
                                    <field name="qualitative_environment" widget="radio"/>
                                </group>

                                <group string="üîß Equipo Utilizado para Cualitativo" 
                                    invisible="qualitative_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="qualitative_equipment_id" 
                                        placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>

                                <group string="üìÖ Fechas del Proceso Cualitativo">
                                    <field name="qualitative_processing_date"/>
                                    <field name="qualitative_processing_time" placeholder="HH:MM"/>
                                </group>

                                <group string="üß™ Medios para An√°lisis Cualitativos">
                                    <field name="qualitative_media_ids" nolabel="1" colspan="2"
                                           context="{'default_process_type': 'qualitative', 'default_media_usage': 'desarrollo_selectivo'}">

                                        <list string="Medios para Cualitativos" create="true" delete="true" edit="true">
                                            <field name="media_source" string="Origen" width="15%"/>
                                            <field name="culture_media_name" string="Nombre del Medio" width="25%"/>
                                            <field name="culture_media_batch_id" 
                                                string="Lote Interno"
                                                invisible="media_source != 'internal'"
                                                width="20%"/>
                                            <field name="external_batch_code" 
                                                string="Lote Externo" 
                                                invisible="media_source != 'external'"
                                                width="20%"/>
                                            <field name="media_usage" string="Uso" width="20%"/>
                                            <field name="requires_incubation" string="¬øIncubaci√≥n?"/>
                                            <field name="incubation_status" 
                                                invisible="requires_incubation == False"
                                                decoration-success="incubation_status == 'completed'"
                                                decoration-warning="incubation_status == 'overdue'"
                                                decoration-info="incubation_status == 'active'"/>
                                            <field name="qualitative_result" string="Resultado" optional="show"/>
                                        </list>
                                        
                                        <form string="Medio para Cualitativo">
                                            <!-- Mismo form structure -->
                                            <group>
                                                <group>
                                                    <field name="process_type" invisible="1"/>
                                                    <field name="media_source" widget="radio"/>
                                                    <field name="culture_media_name" 
                                                        placeholder="Nombre del medio de cultivo"
                                                        required="1"/>
                                                </group>

                                                <group string="Lote del Medio">
                                                    <field name="culture_media_batch_id" 
                                                        invisible="media_source != 'internal'"
                                                        placeholder="Seleccionar lote interno"
                                                        options="{'no_create': True}"/>
                                                    <field name="external_batch_code" 
                                                        invisible="media_source != 'external'"
                                                        placeholder="C√≥digo del lote externo"
                                                        required="media_source == 'external'"/>
                                                </group>

                                                <group>
                                                    <field name="media_usage" 
                                                        string="Uso del Medio"
                                                        required="1"/>
                                                    <field name="requires_incubation" string="¬øRequiere Incubaci√≥n?"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üå°Ô∏è Incubaci√≥n" 
                                                   invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_equipment" 
                                                           placeholder="Equipo utilizado"/>
                                                    <field name="incubation_start_date"/>
                                                    <field name="incubation_start_time" placeholder="HH:MM"/>
                                                </group>
                                                <group>
                                                    <field name="incubation_end_date"/>
                                                    <field name="incubation_end_time" placeholder="HH:MM"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üìä Estado de Incubaci√≥n" 
                                                invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_status" readonly="1"/>
                                                    <field name="time_remaining" readonly="1" 
                                                        invisible="incubation_status != 'active'"/>
                                                    <field name="is_overdue" readonly="1" widget="boolean_toggle"/>
                                                </group>

                                                <group>
                                                    <field name="incubation_end_date_real"/>
                                                    <field name="incubation_end_time_real" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                            <group string="üß™ Resultado en este Medio (Si Aplica)">
                                                <field name="qualitative_result"/>
                                            </group>

                                            <group string="üìù Notas de Preparaci√≥n">
                                                <field name="preparation_notes" nolabel="1"
                                                       placeholder="Instrucciones especiales, observaciones, etc..."/>
                                            </group>
                                        </form>
                                    </field>
                                </group>

                            </page>

                            <!-- ========== TAB DE DATOS CRUDOS (SOLO MICROBIOLOG√çA CUANTITATIVA) ========== -->
                            <page string="üî¢ Datos Crudos de Diluciones" 
                                invisible="category != 'microbiological' or result_type != 'quantitative'">
                                
                                <div class="alert alert-info" style="margin-bottom: 15px;">
                                    <strong>üìù Informaci√≥n:</strong> Esta tabla es para registrar datos crudos √∫nicamente. 
                                    Los c√°lculos son informativos. El resultado final debe ingresarse manualmente en la pesta√±a "Resultado".
                                </div>
                                
                                <field name="raw_dilution_data_ids" nolabel="1">
                                    <list string="Diluciones" editable="bottom">
                                        <field name="method_type" width="20%"/>
                                        <field name="dilution_factor" width="10%"/>
                                        <!-- UFC -->
                                        <field name="ufc_count" invisible="method_type != 'ufc'" width="10%"/>
                                        <!-- NMP -->
                                        <field name="positive_tubes" invisible="method_type != 'nmp'" width="10%"/>
                                        <field name="total_tubes" invisible="method_type != 'nmp'" width="10%"/>
                                        <field name="nmp_result" invisible="method_type != 'nmp'" width="10%"/>
                                        <!-- Resultado calculado -->
                                        <field name="calculated_result" readonly="1" width="10%"/>
                                        <field name="observations" width="20%"/>
                                    </list>
                                </field>
                                
                                <!-- C√°lculos informativos -->
                                <group string="üìä C√°lculos Informativos (Solo Referencia)">
                                    <field name="dilution_calculations" nolabel="1" readonly="1" 
                                        widget="text" style="font-family: monospace;"/>
                                </group>
                            </page>

                            <!-- ========== TAB DE CONTROL DE CALIDAD ========== -->
                            <page string="üî¨ Control de Calidad">
                                
                                <div class="alert alert-info" style="margin-bottom: 15px;">
                                    <strong>üìã Controles de Calidad:</strong> 
                                    Estos controles garantizan la calidad y confiabilidad de los resultados.
                                </div>
                                
                                <style>
                                    .o_list_view .o_list_table {
                                        min-width: 1200px !important;
                                    }
                                </style>
                                
                                <!-- Bot√≥n para copiar desde plantilla -->
                                <div class="oe_button_box" style="margin-bottom: 15px;">
                                    <button type="object" 
                                            name="action_copy_qc_from_template" 
                                            string="üìã Copiar desde Plantilla" 
                                            class="btn-secondary"
                                            help="Copiar controles desde la plantilla del par√°metro"/>
                                </div>
                                
                                <div style="width: 100%; overflow-x: auto;">
                                    <field name="executed_qc_ids" nolabel="1">
                                        <list string="Controles de Calidad" editable="top" create="true" delete="true">
                                            <field name="qc_type_id" string="Tipo de Control" width="20%"/>
                                            <field name="expected_result" string="Resultado Esperado" width="12%"/>
                                            <field name="actual_result" string="Resultado Obtenido" width="12%"/>
                                            
                                            <field name="control_status" string="Estado" width="12%"
                                                decoration-success="control_status == 'passed'"
                                                decoration-warning="control_status == 'in_progress'"
                                                decoration-danger="control_status == 'failed'"
                                                decoration-muted="control_status == 'not_applicable'"/>
                                            
                                            <field name="execution_date" string="Fecha" width="8%"/>
                                            <field name="executed_by_name" string="Realizado Por" width="12%"/>
                                            
                                        </list>
                                    </field>
                                </div>
                            </page>

                            <!-- ========== TAB DE CONFIRMACI√ìN ========== -->
                            <page string="‚úÖ Confirmaci√≥n" invisible="requires_confirmation == False">
                                
                                <group string="Ambiente de Procesamiento">
                                    <field name="confirmation_environment" widget="radio"/>
                                </group>
                                
                                <group string="Equipo Utilizado" 
                                       invisible="confirmation_environment not in ['campana_flujo', 'campana_bioseguridad']">
                                    <field name="confirmation_equipment_id" 
                                           placeholder="Seleccionar equipo espec√≠fico"/>
                                </group>
                                
                                <group string="Fechas del Proceso">
                                    <field name="confirmation_processing_date"/>
                                    <field name="confirmation_processing_time" placeholder="HH:MM"/>
                                </group>
                                
                                <group string="Medios de Confirmaci√≥n">
                                    <field name="confirmation_media_ids" nolabel="1" colspan="2"
                                           context="{'default_process_type': 'confirmation', 'default_media_usage': 'pruebas_bioquimicas'}">
                                        
                                        <list string="Medios para Confirmaci√≥n" create="true" delete="true" edit="true">
                                            <field name="media_source" string="Origen" width="15%"/>
                                            <field name="culture_media_name" string="Nombre del Medio" width="25%"/>
                                            <field name="culture_media_batch_id" 
                                                string="Lote Interno"
                                                invisible="media_source != 'internal'"
                                                width="20%"/>
                                            <field name="external_batch_code" 
                                                string="Lote Externo" 
                                                invisible="media_source != 'external'"
                                                width="20%"/>
                                            <field name="media_usage" string="Uso" width="20%"/>
                                            <field name="requires_incubation" string="¬øIncubaci√≥n?"/>
                                            <field name="incubation_status" 
                                                invisible="requires_incubation == False"
                                                decoration-success="incubation_status == 'completed'"
                                                decoration-warning="incubation_status == 'overdue'"
                                                decoration-info="incubation_status == 'active'"/>
                                            <field name="qualitative_result" string="Resultado" optional="show"/>
                                        </list>
                                        
                                        <form string="Medio de Confirmaci√≥n">
                                            <!-- Mismo form structure -->
                                            <group>
                                                <group>
                                                    <field name="process_type" invisible="1"/>
                                                    <field name="media_source" widget="radio"/>
                                                    <field name="culture_media_name" 
                                                        placeholder="Nombre del medio de cultivo"
                                                        required="1"/>
                                                </group>

                                                <group string="Lote del Medio">
                                                    <field name="culture_media_batch_id" 
                                                        invisible="media_source != 'internal'"
                                                        placeholder="Seleccionar lote interno"
                                                        options="{'no_create': True}"/>
                                                    <field name="external_batch_code" 
                                                        invisible="media_source != 'external'"
                                                        placeholder="C√≥digo del lote externo"
                                                        required="media_source == 'external'"/>
                                                </group>

                                                <group>
                                                    <field name="media_usage" 
                                                        string="Uso del Medio"
                                                        required="1"/>
                                                    <field name="requires_incubation" string="¬øRequiere Incubaci√≥n?"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üå°Ô∏è Incubaci√≥n" 
                                                   invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_equipment" 
                                                           placeholder="Equipo utilizado"/>
                                                    <field name="incubation_start_date"/>
                                                    <field name="incubation_start_time" placeholder="HH:MM"/>
                                                </group>
                                                <group>
                                                    <field name="incubation_end_date"/>
                                                    <field name="incubation_end_time" placeholder="HH:MM"/>
                                                </group>
                                            </group>
                                            
                                            <group string="üìä Estado de Incubaci√≥n" 
                                                invisible="requires_incubation == False">
                                                <group>
                                                    <field name="incubation_status" readonly="1"/>
                                                    <field name="time_remaining" readonly="1" 
                                                        invisible="incubation_status != 'active'"/>
                                                    <field name="is_overdue" readonly="1" widget="boolean_toggle"/>
                                                </group>

                                                <group>
                                                    <field name="incubation_end_date_real"/>
                                                    <field name="incubation_end_time_real" placeholder="HH:MM"/>
                                                </group>
                                            </group>

                                            <group string="üß™ Resultado en este Medio (Si Aplica)">
                                                <field name="qualitative_result"/>
                                            </group>

                                            <group string="üìù Notas de Preparaci√≥n">
                                                <field name="preparation_notes" nolabel="1"
                                                       placeholder="Instrucciones especiales, observaciones, etc..."/>
                                            </group>
                                        </form>
                                    </field>
                                </group>
                            </page>

                            <!-- ========== TAB DE RESULTADO FINAL ========== -->
                            <page string="üìä Resultado Final">
                                
                                <!-- RESULTADO CUALITATIVO -->
                                <group string="üìä Resultado Cualitativo" 
                                       invisible="result_type != 'qualitative'">
                                    <field name="result_qualitative"/>
                                    <field name="qualitative_unit_selection" string="Unidad/Base"/>
                                    <field name="qualitative_custom_unit" 
                                           placeholder="Especificar unidad personalizada"
                                           invisible="qualitative_unit_selection != 'custom'"/>
                                </group>

                                <!-- RESULTADO CUANTITATIVO -->
                                <group string="üî¢ Resultado Cuantitativo" 
                                       invisible="result_type != 'quantitative'">
                                    <field name="result_quantitative_text" 
                                        placeholder="Ej: 1.2 x 10¬≤,  0.01, 7.2"
                                        class="o_field_highlight"/>
                                    <field name="result_unit_selection"/>
                                    <field name="custom_unit" 
                                           placeholder="Especificar unidad"
                                           invisible="result_unit_selection != 'custom'"/>
                                </group>

                                <!-- RESULTADO PRINCIPAL -->
                                <group string="‚úÖ Resultado Principal" colspan="4">
                                    <field name="result_value" 
                                           class="o_field_highlight"
                                           style="font-size: 18px; font-weight: bold;"
                                           placeholder="Ingrese el resultado final aqu√≠..."/>
                                </group>

                                <!-- EQUIPOS ADICIONALES -->
                                <group string="üîß Equipos Adicionales Utilizados">
                                    <field name="equipment_involved_ids" nolabel="1">
                                        <list string="Equipos" editable="bottom">
                                            <field name="equipment_id" string="Equipo"/>
                                            <field name="usage" string="Uso" placeholder="Especificar uso del equipo"/>
                                            <field name="usage_date" string="Fecha"/>
                                            <field name="used_by_name" string="Utilizado por"/>
                                        </list>
                                    </field>
                                </group>

                                <!-- OBSERVACIONES -->
                                <group string="üìù Observaciones del Analista">
                                    <field name="analyst_notes" nolabel="1"
                                           placeholder="Observaciones t√©cnicas del an√°lisis..."/>
                                </group>
                            </page>

                        </notebook>

                    </sheet>
                </form>
            </field>
        </record>

        <!-- ========== VISTA LISTA DE PAR√ÅMETROS ========== -->
        <record id="view_parameter_analysis_v2_list" model="ir.ui.view">
            <field name="name">lims.parameter.analysis.v2.list</field>
            <field name="model">lims.parameter.analysis.v2</field>
            <field name="arch" type="xml">
                <list string="Par√°metros de An√°lisis v2" 
                      create="false"
                      decoration-success="report_status == 'ready'"
                      decoration-info="report_status == 'reported'"
                      decoration-muted="report_status == 'draft'">
                    <field name="analysis_id"/>
                    <field name="name"/>
                    <field name="microorganism"/>
                    <field name="method"/>
                    <field name="result_type"/>
                    <field name="category"/>
                    <field name="analysis_status_checkbox" 
                           decoration-success="analysis_status_checkbox == 'finalizado'"
                           decoration-info="analysis_status_checkbox == 'en_proceso'"
                           decoration-muted="analysis_status_checkbox == 'sin_procesar'"/>
                    <field name="report_status" 
                           decoration-success="report_status == 'ready'"
                           decoration-info="report_status == 'reported'"
                           decoration-muted="report_status == 'draft'"/>
                    <field name="result_complete" class="o_field_highlight"/>
                    <field name="analyst_names"/>
                    <field name="analysis_start_date"/>
                </list>
            </field>
        </record>

        <!-- ========== VISTA DE B√öSQUEDA PARA PAR√ÅMETROS ========== -->
        <record id="view_parameter_analysis_v2_search" model="ir.ui.view">
            <field name="name">lims.parameter.analysis.v2.search</field>
            <field name="model">lims.parameter.analysis.v2</field>
            <field name="arch" type="xml">
                <search string="Buscar Par√°metros v2">
                    <field name="name"/>
                    <field name="microorganism"/>
                    <field name="method"/>
                    <field name="analysis_id"/>
                    <field name="analyst_names"/>
                    
                    <filter string="üî¢ Cuantitativos" 
                            name="quantitative"
                            domain="[('result_type', '=', 'quantitative')]"/>
                    
                    <filter string="üß™ Cualitativos" 
                            name="qualitative"
                            domain="[('result_type', '=', 'qualitative')]"/>
                    
                    <separator/>
                    
                    <filter string="üìã Listos para Reporte" 
                            name="ready"
                            domain="[('report_status', '=', 'ready')]"/>
                    
                    <filter string="‚úÖ Ya Reportados" 
                            name="reported"
                            domain="[('report_status', '=', 'reported')]"/>
                    
                    <filter string="‚è≥ En Proceso" 
                            name="draft"
                            domain="[('report_status', '=', 'draft')]"/>
                    
                    <separator/>
                    
                    <filter string="üî¨ Microbiol√≥gicos" 
                            name="microbiological"
                            domain="[('category', '=', 'microbiological')]"/>
                    
                    <filter string="üß™ Qu√≠micos" 
                            name="chemical"
                            domain="[('category', '=', 'chemical')]"/>
                    
                    <filter string="‚öñÔ∏è F√≠sicos" 
                            name="physical"
                            domain="[('category', '=', 'physical')]"/>
                    
                    <group expand="0" string="Agrupar Por">
                        <filter string="An√°lisis" 
                                name="group_analysis"
                                context="{'group_by': 'analysis_id'}"/>
                        <filter string="Tipo de Resultado" 
                                name="group_result_type"
                                context="{'group_by': 'result_type'}"/>
                        <filter string="Categor√≠a" 
                                name="group_category"
                                context="{'group_by': 'category'}"/>
                        <filter string="Estado de Reporte" 
                                name="group_report_status"
                                context="{'group_by': 'report_status'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- ========== ACCI√ìN PARA PAR√ÅMETROS ========== -->
        <record id="action_parameter_analysis_v2" model="ir.actions.act_window">
            <field name="name">Par√°metros de An√°lisis</field>
            <field name="res_model">lims.parameter.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="search_view_id" ref="view_parameter_analysis_v2_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No hay par√°metros de an√°lisis
                </p>
                <p>
                    Los par√°metros se crean autom√°ticamente al crear an√°lisis.
                    <br/>Utiliza esta vista para revisar y gestionar par√°metros espec√≠ficos.
                </p>
            </field>
        </record>

        <!-- ========== MEN√ö PARA PAR√ÅMETROS ========== -->
        <menuitem id="menu_parameter_analysis_v2" 
                name="üìã Par√°metros de An√°lisis" 
                parent="lims_analysis_v2.menu_lims_analysis_v2_root" 
                action="action_parameter_analysis_v2" 
                sequence="20"/>

    </data>
</odoo>