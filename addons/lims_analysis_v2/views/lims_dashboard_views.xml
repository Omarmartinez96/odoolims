<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Vista de Dashboard usando Kanban -->
        <record id="view_lims_dashboard_kanban" model="ir.ui.view">
            <field name="name">lims.dashboard.kanban</field>
            <field name="model">lims.analysis.v2</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_dashboard" create="false" edit="false" sample="0">
                    <field name="id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="container o_kanban_card_manage_pane">
                                <div class="row mt-4">
                                    
                                    <!-- TARJETAS PRINCIPALES -->
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center bg-primary text-white">
                                            <div class="card-body">
                                                <h2 class="card-title">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([])"/>
                                                </h2>
                                                <p class="card-text">üìä Total de Muestras</p>
                                                <a type="action" name="%(action_lims_analysis_v2)d" class="btn btn-light btn-sm">
                                                    Ver Todas
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center bg-success text-white">
                                            <div class="card-body">
                                                <h2 class="card-title">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([('all_parameters_ready', '=', True)])"/>
                                                </h2>
                                                <p class="card-text">‚úÖ Todos los Par√°metros Listos</p>
                                                <a type="action" name="%(action_dashboard_samples_ready)d" class="btn btn-light btn-sm">
                                                    Ver Muestras
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center bg-warning">
                                            <div class="card-body">
                                                <h2 class="card-title">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([('has_ready_parameters', '=', True), ('all_parameters_ready', '=', False)])"/>
                                                </h2>
                                                <p class="card-text">‚è≥ Par√°metros en Proceso</p>
                                                <a type="action" name="%(action_dashboard_samples_in_process)d" class="btn btn-dark btn-sm">
                                                    Ver Muestras
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- SEGUNDA FILA -->
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center bg-info text-white">
                                            <div class="card-body">
                                                <h2 class="card-title">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([('signature_state', '=', 'signed')])"/>
                                                </h2>
                                                <p class="card-text">‚úçÔ∏è Muestras Firmadas</p>
                                                <a type="action" name="%(action_dashboard_samples_signed)d" class="btn btn-light btn-sm">
                                                    Ver Firmadas
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center bg-secondary text-white">
                                            <div class="card-body">
                                                <h2 class="card-title">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([('report_sent_to_client', '=', True)])"/>
                                                </h2>
                                                <p class="card-text">üìß Reportadas al Cliente</p>
                                                <a type="action" name="%(action_dashboard_samples_reported)d" class="btn btn-light btn-sm">
                                                    Ver Reportadas
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-4 col-md-6 mb-4">
                                        <div class="card text-center border-primary">
                                            <div class="card-body">
                                                <h2 class="card-title text-primary">
                                                    <t t-esc="record.env['lims.analysis.v2'].search_count([('reception_date', '=', context_today())])"/>
                                                </h2>
                                                <p class="card-text">üìÖ Recibidas Hoy</p>
                                                <a type="action" name="%(action_dashboard_samples_today)d" class="btn btn-primary btn-sm">
                                                    Ver de Hoy
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                                
                                <!-- ESTAD√çSTICAS ADICIONALES -->
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h5>üìà Estad√≠sticas R√°pidas</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-md-3">
                                                        <strong>Esta Semana:</strong><br/>
                                                        <span class="badge badge-pill badge-primary" style="font-size: 1.2em;">
                                                            <t t-esc="record.env['lims.analysis.v2'].search_count([('reception_date', '>=', (context_today() - datetime.timedelta(days=7)))])"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <strong>Sin Procesar:</strong><br/>
                                                        <span class="badge badge-pill badge-danger" style="font-size: 1.2em;">
                                                            <t t-esc="record.env['lims.analysis.v2'].search_count([('has_ready_parameters', '=', False)])"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <strong>Con Revisiones:</strong><br/>
                                                        <span class="badge badge-pill badge-warning" style="font-size: 1.2em;">
                                                            <t t-esc="record.env['lims.analysis.v2'].search_count([('revision_count', '>', 0)])"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <strong>Promedio/D√≠a:</strong><br/>
                                                        <span class="badge badge-pill badge-info" style="font-size: 1.2em;">
                                                            <t t-esc="round(record.env['lims.analysis.v2'].search_count([]) / 30.0, 1)"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- ACCIONES PARA FILTROS -->
        <record id="action_dashboard_samples_ready" model="ir.actions.act_window">
            <field name="name">Muestras con Par√°metros Listos</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('all_parameters_ready', '=', True)]</field>
            <field name="context">{'group_by': 'custody_chain_id'}</field>
        </record>
        
        <record id="action_dashboard_samples_in_process" model="ir.actions.act_window">
            <field name="name">Muestras en Proceso</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('has_ready_parameters', '=', True), ('all_parameters_ready', '=', False)]</field>
            <field name="context">{'group_by': 'custody_chain_id'}</field>
        </record>
        
        <record id="action_dashboard_samples_signed" model="ir.actions.act_window">
            <field name="name">Muestras Firmadas</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('signature_state', '=', 'signed')]</field>
            <field name="context">{'group_by': 'custody_chain_id'}</field>
        </record>
        
        <record id="action_dashboard_samples_reported" model="ir.actions.act_window">
            <field name="name">Muestras Reportadas</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('report_sent_to_client', '=', True)]</field>
            <field name="context">{'group_by': 'custody_chain_id'}</field>
        </record>
        
        <record id="action_dashboard_samples_today" model="ir.actions.act_window">
            <field name="name">Muestras de Hoy</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">list,form</field>
            <field name="domain">[('reception_date', '=', context_today())]</field>
            <field name="context">{'group_by': 'custody_chain_id'}</field>
        </record>
        
        <!-- ACCI√ìN PRINCIPAL DEL DASHBOARD -->
        <record id="action_lims_dashboard" model="ir.actions.act_window">
            <field name="name">Dashboard LIMS</field>
            <field name="res_model">lims.analysis.v2</field>
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="view_lims_dashboard_kanban"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Bienvenido al Dashboard LIMS
                </p>
                <p>
                    Aqu√≠ puedes ver un resumen de todas las muestras y su estado actual.
                </p>
            </field>
        </record>
        
        <!-- MEN√ö DEL DASHBOARD -->
        <menuitem id="menu_lims_dashboard" 
                  name="üìä Dashboard" 
                  parent="menu_lims_analysis_v2_root" 
                  action="action_lims_dashboard" 
                  sequence="1"/>
        
    </data>
</odoo>